<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FKTP DENKESYAH 02.04.03</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #1e3a8a;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4b5563;
        }
        
        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="number"],
        textarea,
        select,
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        button {
            background-color: #2563eb;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin: 5px;
        }
        
        button:hover {
            background-color: #1d4ed8;
        }
        
        .btn-secondary {
            background-color: #6b7280;
        }
        
        .btn-success {
            background-color: #059669;
        }
        
        .btn-danger {
            background-color: #dc2626;
        }
        
        .btn-warning {
            background-color: #d97706;
        }
        
        .btn-info {
            background-color: #0891b2;
        }
        
        .help-section {
            background-color: #dbeafe;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .error {
            background-color: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            display: none;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .clinic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .clinic-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .clinic-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #1e3a8a;
        }
        
        .clinic-detail {
            margin-bottom: 5px;
            color: #4b5563;
            font-size: 14px;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background-color: #f8fafc;
            font-weight: bold;
            color: #1e3a8a;
        }
        
        tr:hover {
            background-color: #f8fafc;
        }
        
        /* Form Styles */
        .form-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        /* Image Upload */
        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
        }
        
        .image-upload {
            border: 2px dashed #d1d5db;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-upload:hover {
            border-color: #2563eb;
            background-color: #f0f7ff;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            background: none;
            font-weight: 500;
        }
        
        .tab.active {
            border-color: #e5e7eb;
            border-bottom-color: white;
            background: white;
            border-radius: 6px 6px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Filter Section */
        .filter-section {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="login-section" class="login-container">
            <div class="header">
                <h1>FKTP DENKESYAH 02.04.03</h1>
                <p>www.FKTPDenkesyahLampung.com</p>
            </div>
            
            <div class="help-section">
                <h3>Petunjuk Login:</h3>
                <p>• Username: minkes, Password: minkes123</p>
                <p>• Username: klinik, Password: klinik123</p>
                <p>• Username: user, Password: user123</p>
            </div>
            
            <div id="error-message" class="error">
                Username atau password salah
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                
                <button type="submit">Login</button>
            </form>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="dashboard">
            <div class="dashboard-header">
                <div>
                    <h2>Dashboard FKTP DENKESYAH 02.04.03</h2>
                    <p id="user-display">Halo, User</p>
                </div>
                <div>
                    <button id="btn-dashboard">Dashboard</button>
                    <button id="btn-clinics">Daftar Klinik</button>
                    <button id="btn-recap">Rekap Total</button>
                    <button id="logout-btn" class="btn-danger">Logout</button>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div id="dashboard-content" class="content" style="display: block;">
                <h3>Selamat Datang di Sistem Manajemen FKTP</h3>
                <p>Anda login sebagai: <strong id="user-type-display">-</strong></p>
                <p>Silakan pilih menu di atas untuk mengakses fitur-fitur sistem.</p>
                
                <div id="dashboard-stats">
                    <h4>Statistik Sistem</h4>
                    <p>Total Klinik: <strong id="total-clinics">10</strong></p>
                    <p>Total Pendapatan: <strong>Rp 1.500.000.000</strong></p>
                    <p>Total Realisasi: <strong>Rp 1.200.000.000</strong></p>
                    <p>Sisa Anggaran: <strong>Rp 300.000.000</strong></p>
                </div>
            </div>
            
            <!-- Clinics Content -->
            <div id="clinics-content" class="content" style="display: none;">
                <h3>Daftar Unit FKTP</h3>
                <p>Klik pada klinik untuk melihat detail dan laporan.</p>
                
                <div class="clinic-grid" id="clinics-container">
                    <!-- Daftar klinik akan muncul di sini -->
                </div>
            </div>
            
            <!-- Clinic Detail Content -->
            <div id="clinic-detail-content" class="content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="clinic-detail-title">Detail Klinik</h3>
                    <button id="back-to-clinics" class="btn-secondary">← Kembali ke Daftar Klinik</button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="info">Informasi Klinik</div>
                    <div class="tab" data-tab="income">Laporan Pendapatan</div>
                    <div class="tab" data-tab="realization">Realisasi Pendapatan</div>
                    <div class="tab" data-tab="budget">Sisa Anggaran</div>
                    <div class="tab" data-tab="edit">Edit Klinik</div>
                </div>
                
                <!-- Clinic Info Section -->
                <div id="info-content" class="tab-content active">
                    <div class="form-row">
                        <div>
                            <h4>Informasi Dasar</h4>
                            <p><strong>Nama:</strong> <span id="clinic-name">-</span></p>
                            <p><strong>Alamat:</strong> <span id="clinic-address">-</span></p>
                            <p><strong>Telepon:</strong> <span id="clinic-phone">-</span></p>
                            <p><strong>Email:</strong> <span id="clinic-email">-</span></p>
                        </div>
                        <div>
                            <h4>Gambar Klinik</h4>
                            <img id="clinic-image" class="image-preview" src="" alt="Gambar Klinik">
                        </div>
                    </div>
                </div>
                
                <!-- Income Report Section -->
                <div id="income-content" class="tab-content">
                    <h4>Laporan Pendapatan Kapitasi BPJS</h4>
                    
                    <div class="filter-section">
                        <div class="form-row">
                            <div>
                                <label for="income-year-filter">Tahun</label>
                                <select id="income-year-filter">
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                </select>
                            </div>
                            <div>
                                <label for="income-month-filter">Bulan</label>
                                <select id="income-month-filter">
                                    <option value="all">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <button id="add-income-btn" class="btn-success" style="display: none;">+ Tambah Data Pendapatan</button>
                    
                    <div id="income-form" style="display: none; margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <h4>Form Input Pendapatan</h4>
                        <div class="form-row">
                            <div>
                                <label for="income-month">Bulan</label>
                                <select id="income-month">
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                            <div>
                                <label for="income-year">Tahun</label>
                                <select id="income-year">
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                </select>
                            </div>
                            <div>
                                <label for="income-amount">Jumlah Pendapatan (Rp)</label>
                                <input type="number" id="income-amount" min="0" placeholder="Masukkan jumlah pendapatan">
                            </div>
                        </div>
                        <div>
                            <button type="button" id="save-income-btn" class="btn-success">Simpan</button>
                            <button type="button" id="cancel-income-btn" class="btn-secondary">Batal</button>
                        </div>
                    </div>
                    
                    <table id="income-table">
                        <thead>
                            <tr>
                                <th>Bulan</th>
                                <th>Tahun</th>
                                <th>Jumlah Pendapatan (Rp)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="income-table-body">
                            <!-- Data pendapatan akan muncul di sini -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Realization Report Section -->
                <div id="realization-content" class="tab-content">
                    <h4>Realisasi Pendapatan</h4>
                    
                    <div class="filter-section">
                        <div class="form-row">
                            <div>
                                <label for="realization-year-filter">Tahun</label>
                                <select id="realization-year-filter">
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                </select>
                            </div>
                            <div>
                                <label for="realization-month-filter">Bulan</label>
                                <select id="realization-month-filter">
                                    <option value="all">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <h5>Honor/Jasa (30%)</h5>
                    <div class="form-row">
                        <div>
                            <label for="honor-medis">Medis (Rp)</label>
                            <input type="number" id="honor-medis" min="0" value="30000000">
                        </div>
                        <div>
                            <label for="honor-paramedis">Paramedis (Rp)</label>
                            <input type="number" id="honor-paramedis" min="0" value="15000000">
                        </div>
                        <div>
                            <label for="honor-pengelola">Pengelola (Rp)</label>
                            <input type="number" id="honor-pengelola" min="0" value="10000000">
                        </div>
                    </div>
                    <button id="save-honor-btn" class="btn-success">Update Honor</button>
                    
                    <h5 style="margin-top: 30px;">Operasional (50%)</h5>
                    <div class="form-row">
                        <div>
                            <label for="operational-atk">Belanja ATK (Rp)</label>
                            <input type="number" id="operational-atk" min="0" value="25000000">
                        </div>
                        <div>
                            <label for="operational-obat">Belanja Obat (Rp)</label>
                            <input type="number" id="operational-obat" min="0" value="55000000">
                        </div>
                    </div>
                    <button id="save-operational-btn" class="btn-success">Update Operasional</button>
                    
                    <h5 style="margin-top: 30px;">Belanja Modal (20%)</h5>
                    <button id="add-modal-btn" class="btn-success">+ Tambah Item Belanja Modal</button>
                    
                    <div id="modal-form" style="display: none; margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <h4>Form Input Item Belanja Modal</h4>
                        <div class="form-row">
                            <div>
                                <label for="modal-name">Nama Barang</label>
                                <input type="text" id="modal-name" placeholder="Masukkan nama barang">
                            </div>
                            <div>
                                <label for="modal-unit">Satuan</label>
                                <input type="text" id="modal-unit" placeholder="Masukkan satuan">
                            </div>
                            <div>
                                <label for="modal-price">Harga (Rp)</label>
                                <input type="number" id="modal-price" min="0" placeholder="Masukkan harga">
                            </div>
                            <div>
                                <label for="modal-quantity">Jumlah</label>
                                <input type="number" id="modal-quantity" min="1" placeholder="Masukkan jumlah">
                            </div>
                        </div>
                        <div>
                            <button type="button" id="save-modal-btn" class="btn-success">Simpan Item</button>
                            <button type="button" id="cancel-modal-btn" class="btn-secondary">Batal</button>
                        </div>
                    </div>
                    
                    <table id="modal-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Barang</th>
                                <th>Satuan</th>
                                <th>Harga</th>
                                <th>Jumlah</th>
                                <th>Total</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="modal-table-body">
                            <!-- Data belanja modal akan muncul di sini -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Budget Remaining Section -->
                <div id="budget-content" class="tab-content">
                    <h4>Sisa Anggaran</h4>
                    
                    <div class="filter-section">
                        <div class="form-row">
                            <div>
                                <label for="budget-year-filter">Tahun</label>
                                <select id="budget-year-filter">
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                </select>
                            </div>
                            <div>
                                <label for="budget-month-filter">Bulan</label>
                                <select id="budget-month-filter">
                                    <option value="all">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h5>Ringkasan Anggaran</h5>
                        <div class="form-row">
                            <div>
                                <p><strong>Total Anggaran:</strong> <span id="total-budget">Rp 165.000.000</span></p>
                            </div>
                            <div>
                                <p><strong>Telah Digunakan:</strong> <span id="total-spent">Rp 120.000.000</span></p>
                            </div>
                            <div>
                                <p><strong>Sisa Anggaran:</strong> <span id="remaining-budget">Rp 45.000.000</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <button id="add-budget-btn" class="btn-success" style="display: none;">+ Tambah Data Anggaran Bulanan</button>
                    
                    <div id="budget-form" style="display: none; margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <h4>Form Input Anggaran Bulanan</h4>
                        <div class="form-row">
                            <div>
                                <label for="budget-month">Bulan</label>
                                <select id="budget-month">
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                            <div>
                                <label for="budget-year">Tahun</label>
                                <select id="budget-year">
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                </select>
                            </div>
                            <div>
                                <label for="budget-amount">Total Anggaran (Rp)</label>
                                <input type="number" id="budget-amount" min="0" placeholder="Masukkan total anggaran">
                            </div>
                            <div>
                                <label for="budget-spent">Telah Digunakan (Rp)</label>
                                <input type="number" id="budget-spent" min="0" placeholder="Masukkan yang telah digunakan">
                            </div>
                        </div>
                        <div>
                            <button type="button" id="save-budget-btn" class="btn-success">Simpan</button>
                            <button type="button" id="cancel-budget-btn" class="btn-secondary">Batal</button>
                        </div>
                    </div>
                    
                    <table id="budget-table">
                        <thead>
                            <tr>
                                <th>Bulan</th>
                                <th>Tahun</th>
                                <th>Total Anggaran</th>
                                <th>Telah Digunakan</th>
                                <th>Sisa Anggaran</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="budget-table-body">
                            <!-- Data sisa anggaran bulanan akan muncul di sini -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Edit Clinic Form -->
                <div id="edit-content" class="tab-content">
                    <h4>Edit Informasi Klinik</h4>
                    <form id="edit-clinic-form">
                        <input type="hidden" id="edit-clinic-id">
                        <div class="form-row">
                            <div>
                                <label for="edit-clinic-name">Nama Klinik</label>
                                <input type="text" id="edit-clinic-name" required>
                            </div>
                            <div>
                                <label for="edit-clinic-address">Alamat</label>
                                <input type="text" id="edit-clinic-address" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label for="edit-clinic-phone">Telepon</label>
                                <input type="text" id="edit-clinic-phone" required>
                            </div>
                            <div>
                                <label for="edit-clinic-email">Email</label>
                                <input type="email" id="edit-clinic-email" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit-clinic-image">Upload Gambar Klinik</label>
                            <div class="image-upload" id="image-upload-area">
                                <p>Klik untuk upload gambar</p>
                            </div>
                            <input type="file" id="edit-clinic-image" accept="image/*" style="display: none;">
                            <img id="edit-clinic-image-preview" class="image-preview" src="" alt="Preview Gambar">
                        </div>
                        <div>
                            <button type="submit" class="btn-success">Simpan Perubahan</button>
                            <button type="button" id="cancel-edit-btn" class="btn-secondary">Batal</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Total Recap Content -->
            <div id="recap-content" class="content" style="display: none;">
                <h3>Rekap Total Semua Unit FKTP</h3>
                
                <div class="filter-section">
                    <div class="form-row">
                        <div>
                            <label for="recap-year-filter">Tahun</label>
                            <select id="recap-year-filter">
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                                <option value="2024" selected>2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029">2029</option>
                            </select>
                        </div>
                        <div>
                            <label for="recap-month-filter">Bulan</label>
                            <select id="recap-month-filter">
                                <option value="all">Semua Bulan</option>
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Maret</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Juni</option>
                                <option value="7">Juli</option>
                                <option value="8">Agustus</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <button id="download-excel" class="btn-info">Download Excel</button>
                    <button id="download-powerpoint" class="btn-info">Download PowerPoint</button>
                </div>
                
                <table id="recap-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Unit</th>
                            <th>Total Pendapatan</th>
                            <th>Total Realisasi</th>
                            <th>Sisa</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="recap-table-body">
                        <!-- Data rekap akan muncul di sini -->
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            // Data klinik
            let clinics = [
                { 
                    id: 1, 
                    name: 'Klinik Gatam Kedaton', 
                    address: 'Jl. Gatot Subroto No. 123, Kedaton, Bandar Lampung', 
                    phone: '0721-1234567', 
                    email: 'gatamkedaton@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/1e3a8a/ffffff?text=Klinik+Gatam+Kedaton',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 30000000, paramedis: 15000000, pengelola: 10000000 },
                        operational: { atk: 25000000, obat: 55000000 },
                        modal: [
                            { id: 1, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 5, total: 2500000 },
                            { id: 2, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 10, total: 3000000 },
                            { id: 3, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 165000000,
                        totalSpent: 120000000,
                        remaining: 45000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 2, 
                    name: 'Polkes 02.10.08 Metro', 
                    address: 'Jl. Jenderal Sudirman No. 45, Metro', 
                    phone: '0725-2345678', 
                    email: 'polkes021008@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/059669/ffffff?text=Polkes+02.10.08+Metro',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 28000000, paramedis: 14000000, pengelola: 9000000 },
                        operational: { atk: 24000000, obat: 53000000 },
                        modal: [
                            { id: 4, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 4, total: 2000000 },
                            { id: 5, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 8, total: 2400000 },
                            { id: 6, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 158000000,
                        totalSpent: 115000000,
                        remaining: 43000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 3, 
                    name: 'Polkes 02.10.09 Kotabumi', 
                    address: 'Jl. Raya Kotabumi No. 78, Kotabumi', 
                    phone: '0724-3456789', 
                    email: 'polkes021009@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/d97706/ffffff?text=Polkes+02.10.09+Kotabumi',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 29000000, paramedis: 14500000, pengelola: 9500000 },
                        operational: { atk: 24500000, obat: 54000000 },
                        modal: [
                            { id: 7, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 6, total: 3000000 },
                            { id: 8, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 12, total: 3600000 },
                            { id: 9, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 4, total: 3200000 }
                        ]
                    },
                    budget: {
                        totalBudget: 162000000,
                        totalSpent: 118000000,
                        remaining: 44000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 4, 
                    name: 'Polkes 02.10.15 Kalianda', 
                    address: 'Jl. Raya Kalianda No. 23, Kalianda', 
                    phone: '0727-4567890', 
                    email: 'polkes021015@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/7c3aed/ffffff?text=Polkes+02.10.15+Kalianda',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 27000000, paramedis: 13500000, pengelola: 8500000 },
                        operational: { atk: 23000000, obat: 51000000 },
                        modal: [
                            { id: 10, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 3, total: 1500000 },
                            { id: 11, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 7, total: 2100000 },
                            { id: 12, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 156000000,
                        totalSpent: 112000000,
                        remaining: 44000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 5, 
                    name: 'Polkes 02.10.16 Liwa', 
                    address: 'Jl. Raya Liwa No. 56, Liwa', 
                    phone: '0728-5678901', 
                    email: 'polkes021016@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/dc2626/ffffff?text=Polkes+02.10.16+Liwa',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 28500000, paramedis: 14200000, pengelola: 9300000 },
                        operational: { atk: 24000000, obat: 53500000 },
                        modal: [
                            { id: 13, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 5, total: 2500000 },
                            { id: 14, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 9, total: 2700000 },
                            { id: 15, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 161000000,
                        totalSpent: 116000000,
                        remaining: 45000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 6, 
                    name: 'Polkes 02.10.17 Tanggamus', 
                    address: 'Jl. Raya Tanggamus No. 89, Tanggamus', 
                    phone: '0722-6789012', 
                    email: 'polkes021017@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/0891b2/ffffff?text=Polkes+02.10.17+Tanggamus',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 27500000, paramedis: 13800000, pengelola: 8700000 },
                        operational: { atk: 23500000, obat: 52000000 },
                        modal: [
                            { id: 16, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 4, total: 2000000 },
                            { id: 17, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 8, total: 2400000 },
                            { id: 18, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 158000000,
                        totalSpent: 114000000,
                        remaining: 44000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 7, 
                    name: 'Polkesdim 0426 Tulang Bawang', 
                    address: 'Jl. Raya Tulang Bawang No. 34, Tulang Bawang', 
                    phone: '0726-7890123', 
                    email: 'polkesdim0426@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/6b7280/ffffff?text=Polkesdim+0426+Tulang+Bawang',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 29500000, paramedis: 14700000, pengelola: 9800000 },
                        operational: { atk: 25000000, obat: 55500000 },
                        modal: [
                            { id: 19, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 6, total: 3000000 },
                            { id: 20, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 11, total: 3300000 },
                            { id: 21, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 4, total: 3200000 }
                        ]
                    },
                    budget: {
                        totalBudget: 163000000,
                        totalSpent: 118000000,
                        remaining: 45000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 8, 
                    name: 'Polkesdim 0427 Way Kanan', 
                    address: 'Jl. Raya Way Kanan No. 67, Way Kanan', 
                    phone: '0728-8901234', 
                    email: 'polkesdim0427@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/059669/ffffff?text=Polkesdim+0427+Way+Kanan',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 27000000, paramedis: 13500000, pengelola: 8500000 },
                        operational: { atk: 23000000, obat: 51500000 },
                        modal: [
                            { id: 22, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 3, total: 1500000 },
                            { id: 23, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 7, total: 2100000 },
                            { id: 24, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 157000000,
                        totalSpent: 113000000,
                        remaining: 44000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 9, 
                    name: 'Polkesdim 0429 Lamtim', 
                    address: 'Jl. Raya Lampung Timur No. 12, Lampung Timur', 
                    phone: '0725-9012345', 
                    email: 'polkesdim0429@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/7c3aed/ffffff?text=Polkesdim+0429+Lamtim',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 28000000, paramedis: 14000000, pengelola: 9000000 },
                        operational: { atk: 24000000, obat: 53000000 },
                        modal: [
                            { id: 25, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 5, total: 2500000 },
                            { id: 26, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 9, total: 2700000 },
                            { id: 27, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 160000000,
                        totalSpent: 115000000,
                        remaining: 45000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                },
                { 
                    id: 10, 
                    name: 'Klinik Tonkes Yonif 143/TWEJ', 
                    address: 'Jl. Raya Sukadana No. 45, Lampung Timur', 
                    phone: '0725-0123456', 
                    email: 'tonkesyonif143@fktpdenkesyah.com',
                    image: 'https://placehold.co/600x400/dc2626/ffffff?text=Klinik+Tonkes+Yonif+143/TWEJ',
                    income: generateSampleIncome(),
                    realization: {
                        honor: { medis: 29000000, paramedis: 14500000, pengelola: 9500000 },
                        operational: { atk: 24500000, obat: 54000000 },
                        modal: [
                            { id: 28, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 6, total: 3000000 },
                            { id: 29, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 10, total: 3000000 },
                            { id: 30, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 162000000,
                        totalSpent: 117000000,
                        remaining: 45000000,
                        monthlyRemaining: generateSampleBudget()
                    }
                }
            ];
            
            // Generate sample income data for 2 years back and 5 years forward
            function generateSampleIncome() {
                const income = [];
                const currentYear = new Date().getFullYear();
                
                // 2 years back
                for (let year = currentYear - 2; year <= currentYear + 5; year++) {
                    for (let month = 1; month <= 12; month++) {
                        // Generate random amount between 140M and 170M
                        const baseAmount = 140000000;
                        const randomVariance = Math.floor(Math.random() * 30000000);
                        const amount = baseAmount + randomVariance;
                        
                        income.push({
                            month: month,
                            year: year,
                            amount: amount
                        });
                    }
                }
                
                return income;
            }
            
            // Generate sample budget data for 2 years back and 5 years forward
            function generateSampleBudget() {
                const budget = [];
                const currentYear = new Date().getFullYear();
                
                // 2 years back
                for (let year = currentYear - 2; year <= currentYear + 5; year++) {
                    for (let month = 1; month <= 12; month++) {
                        // Generate random budget between 150M and 170M
                        const baseBudget = 150000000;
                        const randomVariance = Math.floor(Math.random() * 20000000);
                        const budgetAmount = baseBudget + randomVariance;
                        
                        // Generate random spent between 75% and 85% of budget
                        const spentPercentage = 0.75 + (Math.random() * 0.1);
                        const spent = Math.floor(budgetAmount * spentPercentage);
                        const remaining = budgetAmount - spent;
                        
                        budget.push({
                            month: month,
                            year: year,
                            budget: budgetAmount,
                            spent: spent,
                            remaining: remaining
                        });
                    }
                }
                
                return budget;
            }
            
            // State aplikasi
            let currentUser = null;
            let currentClinic = null;
            let currentEditIndex = null;
            
            // Tunggu hingga halaman sepenuhnya dimuat
            document.addEventListener('DOMContentLoaded', function() {
                console.log('Halaman telah dimuat');
                
                // Setup form login
                const loginForm = document.getElementById('login-form');
                if (loginForm) {
                    loginForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleLogin();
                    });
                }
                
                // Setup logout button
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        handleLogout();
                    });
                }
                
                // Setup navigation buttons
                setupNavigation();
                
                // Setup clinic detail tabs
                setupTabs();
                
                // Setup filters
                setupFilters();
                
                // Setup edit form
                setupEditForm();
                
                // Setup finance forms
                setupFinanceForms();
                
                // Setup image upload
                setupImageUpload();
                
                // Cek apakah user sudah login sebelumnya
                checkSavedLogin();
            });
            
            // Fungsi login
            function handleLogin() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Validasi login
                if ((username === 'minkes' && password === 'minkes123') || 
                    (username === 'klinik' && password === 'klinik123') || 
                    (username === 'user' && password === 'user123')) {
                    
                    // Simpan user ke localStorage
                    try {
                        localStorage.setItem('fktpUser', JSON.stringify({
                            username: username,
                            type: username === 'minkes' ? 'minkes' : 'klinik',
                            isLoggedIn: true
                        }));
                    } catch (e) {
                        console.log('Gagal menyimpan ke localStorage:', e);
                    }
                    
                    // Set current user
                    currentUser = {
                        username: username,
                        type: username === 'minkes' ? 'minkes' : 'klinik'
                    };
                    
                    // Tampilkan dashboard
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('dashboard-section').style.display = 'block';
                    document.getElementById('user-display').textContent = `Halo, ${username}`;
                    document.getElementById('user-type-display').textContent = username === 'minkes' ? 'minkes' : 'klinik';
                    
                    // Load data klinik
                    loadClinics();
                    
                    // Tampilkan dashboard content
                    showDashboard();
                } else {
                    document.getElementById('error-message').style.display = 'block';
                }
            }
            
            // Fungsi logout
            function handleLogout() {
                try {
                    localStorage.removeItem('fktpUser');
                } catch (e) {
                    console.log('Gagal menghapus dari localStorage:', e);
                }
                
                currentUser = null;
                currentClinic = null;
                
                document.getElementById('login-section').style.display = 'block';
                document.getElementById('dashboard-section').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('error-message').style.display = 'none';
            }
            
            // Cek login yang tersimpan
            function checkSavedLogin() {
                try {
                    const savedUser = localStorage.getItem('fktpUser');
                    if (savedUser) {
                        const userData = JSON.parse(savedUser);
                        if (userData.isLoggedIn) {
                            currentUser = {
                                username: userData.username,
                                type: userData.type
                            };
                            
                            document.getElementById('login-section').style.display = 'none';
                            document.getElementById('dashboard-section').style.display = 'block';
                            document.getElementById('user-display').textContent = `Halo, ${userData.username}`;
                            document.getElementById('user-type-display').textContent = userData.type;
                            
                            loadClinics();
                            showDashboard();
                        }
                    }
                } catch (e) {
                    console.log('Error saat mengecek login yang tersimpan:', e);
                }
            }
            
            // Setup navigation
            function setupNavigation() {
                // Dashboard button
                const dashboardBtn = document.getElementById('btn-dashboard');
                if (dashboardBtn) {
                    dashboardBtn.addEventListener('click', function() {
                        showDashboard();
                    });
                }
                
                // Clinics button
                const clinicsBtn = document.getElementById('btn-clinics');
                if (clinicsBtn) {
                    clinicsBtn.addEventListener('click', function() {
                        showClinics();
                    });
                }
                
                // Recap button
                const recapBtn = document.getElementById('btn-recap');
                if (recapBtn) {
                    recapBtn.addEventListener('click', function() {
                        showRecap();
                    });
                }
                
                // Back to clinics button
                const backToClinicsBtn = document.getElementById('back-to-clinics');
                if (backToClinicsBtn) {
                    backToClinicsBtn.addEventListener('click', function() {
                        showClinics();
                    });
                }
            }
            
            // Setup tabs
            function setupTabs() {
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Remove active class from all tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        // Add active class to clicked tab
                        this.classList.add('active');
                        
                        // Hide all content
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        // Show selected content
                        const tabId = this.getAttribute('data-tab');
                        document.getElementById(`${tabId}-content`).classList.add('active');
                        
                        // Load data if needed
                        if (currentClinic) {
                            if (tabId === 'income') {
                                loadClinicIncome(currentClinic);
                            } else if (tabId === 'realization') {
                                loadClinicRealization(currentClinic);
                            } else if (tabId === 'budget') {
                                loadClinicBudget(currentClinic);
                            } else if (tabId === 'edit') {
                                loadClinicEditForm(currentClinic);
                            }
                        }
                    });
                });
            }
            
            // Setup filters
            function setupFilters() {
                // Income filters
                const incomeYearFilter = document.getElementById('income-year-filter');
                const incomeMonthFilter = document.getElementById('income-month-filter');
                
                if (incomeYearFilter) {
                    incomeYearFilter.addEventListener('change', function() {
                        if (currentClinic) {
                            loadClinicIncome(currentClinic);
                        }
                    });
                }
                
                if (incomeMonthFilter) {
                    incomeMonthFilter.addEventListener('change', function() {
                        if (currentClinic) {
                            loadClinicIncome(currentClinic);
                        }
                    });
                }
                
                // Realization filters
                const realizationYearFilter = document.getElementById('realization-year-filter');
                const realizationMonthFilter = document.getElementById('realization-month-filter');
                
                if (realizationYearFilter) {
                    realizationYearFilter.addEventListener('change', function() {
                        if (currentClinic) {
                            loadClinicRealization(currentClinic);
                        }
                    });
                }
                
                if (realizationMonthFilter) {
                    realizationMonthFilter.addEventListener('change', function() {
                        if (currentClinic) {
                            loadClinicRealization(currentClinic);
                        }
                    });
                }
                
                // Budget filters
                const budgetYearFilter = document.getElementById('budget-year-filter');
                const budgetMonthFilter = document.getElementById('budget-month-filter');
                
                if (budgetYearFilter) {
                    budgetYearFilter.addEventListener('change', function() {
                        if (currentClinic) {
                            loadClinicBudget(currentClinic);
                        }
                    });
                }
                
                if (budgetMonthFilter) {
                    budgetMonthFilter.addEventListener('change', function() {
                        if (currentClinic) {
                            loadClinicBudget(currentClinic);
                        }
                    });
                }
                
                // Recap filters
                const recapYearFilter = document.getElementById('recap-year-filter');
                const recapMonthFilter = document.getElementById('recap-month-filter');
                
                if (recapYearFilter) {
                    recapYearFilter.addEventListener('change', function() {
                        loadRecapData();
                    });
                }
                
                if (recapMonthFilter) {
                    recapMonthFilter.addEventListener('change', function() {
                        loadRecapData();
                    });
                }
            }
            
            // Setup edit form
            function setupEditForm() {
                const editForm = document.getElementById('edit-clinic-form');
                if (editForm) {
                    editForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveClinicEdit();
                    });
                }
                
                const cancelEditBtn = document.getElementById('cancel-edit-btn');
                if (cancelEditBtn) {
                    cancelEditBtn.addEventListener('click', function() {
                        showClinicInfo();
                    });
                }
            }
            
            // Setup finance forms
            function setupFinanceForms() {
                // Income form buttons
                const addIncomeBtn = document.getElementById('add-income-btn');
                const saveIncomeBtn = document.getElementById('save-income-btn');
                const cancelIncomeBtn = document.getElementById('cancel-income-btn');
                
                if (addIncomeBtn) {
                    addIncomeBtn.addEventListener('click', function() {
                        document.getElementById('income-form').style.display = 'block';
                        this.style.display = 'none';
                    });
                }
                
                if (cancelIncomeBtn) {
                    cancelIncomeBtn.addEventListener('click', function() {
                        document.getElementById('income-form').style.display = 'none';
                        document.getElementById('add-income-btn').style.display = 'inline-block';
                    });
                }
                
                if (saveIncomeBtn) {
                    saveIncomeBtn.addEventListener('click', function() {
                        saveIncomeData();
                    });
                }
                
                // Honor buttons
                const saveHonorBtn = document.getElementById('save-honor-btn');
                if (saveHonorBtn) {
                    saveHonorBtn.addEventListener('click', function() {
                        saveHonorData();
                    });
                }
                
                // Operational buttons
                const saveOperationalBtn = document.getElementById('save-operational-btn');
                if (saveOperationalBtn) {
                    saveOperationalBtn.addEventListener('click', function() {
                        saveOperationalData();
                    });
                }
                
                // Modal form buttons
                const addModalBtn = document.getElementById('add-modal-btn');
                const saveModalBtn = document.getElementById('save-modal-btn');
                const cancelModalBtn = document.getElementById('cancel-modal-btn');
                
                if (addModalBtn) {
                    addModalBtn.addEventListener('click', function() {
                        document.getElementById('modal-form').style.display = 'block';
                    });
                }
                
                if (cancelModalBtn) {
                    cancelModalBtn.addEventListener('click', function() {
                        document.getElementById('modal-form').style.display = 'none';
                    });
                }
                
                if (saveModalBtn) {
                    saveModalBtn.addEventListener('click', function() {
                        saveModalData();
                    });
                }
                
                // Budget form buttons
                const addBudgetBtn = document.getElementById('add-budget-btn');
                const saveBudgetBtn = document.getElementById('save-budget-btn');
                const cancelBudgetBtn = document.getElementById('cancel-budget-btn');
                
                if (addBudgetBtn) {
                    addBudgetBtn.addEventListener('click', function() {
                        document.getElementById('budget-form').style.display = 'block';
                        this.style.display = 'none';
                    });
                }
                
                if (cancelBudgetBtn) {
                    cancelBudgetBtn.addEventListener('click', function() {
                        document.getElementById('budget-form').style.display = 'none';
                        document.getElementById('add-budget-btn').style.display = 'inline-block';
                    });
                }
                
                if (saveBudgetBtn) {
                    saveBudgetBtn.addEventListener('click', function() {
                        saveBudgetData();
                    });
                }
                
                // Export buttons
                const downloadExcelBtn = document.getElementById('download-excel');
                const downloadPowerPointBtn = document.getElementById('download-powerpoint');
                
                if (downloadExcelBtn) {
                    downloadExcelBtn.addEventListener('click', function() {
                        downloadExcelReport();
                    });
                }
                
                if (downloadPowerPointBtn) {
                    downloadPowerPointBtn.addEventListener('click', function() {
                        downloadPowerPointReport();
                    });
                }
            }
            
            // Setup image upload
            function setupImageUpload() {
                const imageUploadArea = document.getElementById('image-upload-area');
                const imageInput = document.getElementById('edit-clinic-image');
                const imagePreview = document.getElementById('edit-clinic-image-preview');
                
                if (imageUploadArea && imageInput) {
                    // Click to upload
                    imageUploadArea.addEventListener('click', function() {
                        imageInput.click();
                    });
                    
                    // File selection
                    imageInput.addEventListener('change', function() {
                        handleImageUpload();
                    });
                }
            }
            
            // Handle image upload
            function handleImageUpload() {
                const imageInput = document.getElementById('edit-clinic-image');
                const imagePreview = document.getElementById('edit-clinic-image-preview');
                
                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(imageInput.files[0]);
                }
            }
            
            // Tampilkan dashboard
            function showDashboard() {
                hideAllContent();
                document.getElementById('dashboard-content').style.display = 'block';
            }
            
            // Tampilkan daftar klinik
            function showClinics() {
                hideAllContent();
                document.getElementById('clinics-content').style.display = 'block';
                
                // Load data klinik
                loadClinics();
            }
            
            // Tampilkan rekap total
            function showRecap() {
                hideAllContent();
                document.getElementById('recap-content').style.display = 'block';
                
                // Load data rekap
                loadRecapData();
            }
            
            // Sembunyikan semua konten
            function hideAllContent() {
                document.getElementById('dashboard-content').style.display = 'none';
                document.getElementById('clinics-content').style.display = 'none';
                document.getElementById('clinic-detail-content').style.display = 'none';
                document.getElementById('recap-content').style.display = 'none';
            }
            
            // Load daftar klinik
            function loadClinics() {
                const container = document.getElementById('clinics-container');
                if (!container) return;
                
                container.innerHTML = '';
                
                clinics.forEach(clinic => {
                    const clinicCard = document.createElement('div');
                    clinicCard.className = 'clinic-card';
                    clinicCard.innerHTML = `
                        <div class="clinic-name">${clinic.name}</div>
                        <div class="clinic-detail">Alamat: ${clinic.address}</div>
                        <div class="clinic-detail">Telepon: ${clinic.phone}</div>
                        <div class="clinic-detail">Email: ${clinic.email}</div>
                        <div style="margin-top: 15px;">
                            <button class="btn-success view-clinic-btn" data-id="${clinic.id}">Lihat Detail</button>
                            ${currentUser && currentUser.type === 'minkes' ? `<button class="btn-warning edit-clinic-btn" data-id="${clinic.id}">Edit</button>` : ''}
                        </div>
                    `;
                    container.appendChild(clinicCard);
                });
                
                // Setup event listeners untuk tombol view
                document.querySelectorAll('.view-clinic-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const clinicId = parseInt(this.getAttribute('data-id'));
                        viewClinic(clinicId);
                    });
                });
                
                // Update total clinics display
                document.getElementById('total-clinics').textContent = clinics.length;
            }
            
            // Lihat detail klinik
            function viewClinic(clinicId) {
                const clinic = clinics.find(c => c.id === clinicId);
                if (!clinic) return;
                
                currentClinic = clinic;
                
                // Update title
                document.getElementById('clinic-detail-title').textContent = `Detail Klinik: ${clinic.name}`;
                
                // Update info klinik
                document.getElementById('clinic-name').textContent = clinic.name;
                document.getElementById('clinic-address').textContent = clinic.address;
                document.getElementById('clinic-phone').textContent = clinic.phone;
                document.getElementById('clinic-email').textContent = clinic.email;
                
                // Update gambar klinik
                const clinicImage = document.getElementById('clinic-image');
                if (clinicImage) {
                    clinicImage.src = clinic.image;
                }
                
                // Tampilkan tombol edit hanya untuk minkes
                const addIncomeBtn = document.getElementById('add-income-btn');
                const addBudgetBtn = document.getElementById('add-budget-btn');
                
                if (addIncomeBtn && addBudgetBtn) {
                    if (currentUser && currentUser.type === 'minkes') {
                        addIncomeBtn.style.display = 'inline-block';
                        addBudgetBtn.style.display = 'inline-block';
                    } else {
                        addIncomeBtn.style.display = 'none';
                        addBudgetBtn.style.display = 'none';
                    }
                }
                
                // Load data laporan
                loadClinicIncome(clinic);
                loadClinicRealization(clinic);
                loadClinicBudget(clinic);
                loadClinicEditForm(clinic);
                
                // Tampilkan clinic detail content
                hideAllContent();
                document.getElementById('clinic-detail-content').style.display = 'block';
                
                // Tampilkan info section by default
                showClinicInfo();
            }
            
            // Tampilkan info klinik
            function showClinicInfo() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Add active class to info tab
                document.querySelector('[data-tab="info"]').classList.add('active');
                
                // Hide all content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show info content
                document.getElementById('info-content').classList.add('active');
            }
            
            // Load data pendapatan klinik dengan filter
            function loadClinicIncome(clinic) {
                const tbody = document.getElementById('income-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                const yearFilter = document.getElementById('income-year-filter').value;
                const monthFilter = document.getElementById('income-month-filter').value;
                
                // Filter data berdasarkan tahun dan bulan
                let filteredIncome = clinic.income.filter(item => 
                    item.year.toString() === yearFilter
                );
                
                if (monthFilter !== 'all') {
                    filteredIncome = filteredIncome.filter(item => 
                        item.month.toString() === monthFilter
                    );
                }
                
                // Sort by month
                filteredIncome.sort((a, b) => a.month - b.month);
                
                let total = 0;
                filteredIncome.forEach((report, index) => {
                    total += report.amount;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${getMonthName(report.month)}</td>
                        <td>${report.year}</td>
                        <td>Rp ${report.amount.toLocaleString('id-ID')}</td>
                        <td>
                            ${currentUser && currentUser.type === 'minkes' ? `
                            <button class="btn-warning edit-income-btn" data-index="${index}">Edit</button>
                            <button class="btn-danger delete-income-btn" data-index="${index}">Hapus</button>
                            ` : ''}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Setup event listeners untuk tombol edit dan delete
                if (currentUser && currentUser.type === 'minkes') {
                    document.querySelectorAll('.edit-income-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            editIncomeData(index);
                        });
                    });
                    
                    document.querySelectorAll('.delete-income-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            deleteIncomeData(index);
                        });
                    });
                }
                
                // Add total row
                const totalRow = document.createElement('tr');
                totalRow.style.fontWeight = 'bold';
                totalRow.style.backgroundColor = '#f8fafc';
                totalRow.innerHTML = `
                    <td colspan="2"><strong>TOTAL</strong></td>
                    <td><strong>Rp ${total.toLocaleString('id-ID')}</strong></td>
                    <td></td>
                `;
                tbody.appendChild(totalRow);
            }
            
            // Get month name from month number
            function getMonthName(monthNumber) {
                const months = [
                    'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                    'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
                ];
                return months[monthNumber - 1];
            }
            
            // Edit data pendapatan
            function editIncomeData(index) {
                if (!currentClinic) return;
                
                // Find the actual index in the original array
                const yearFilter = document.getElementById('income-year-filter').value;
                const monthFilter = document.getElementById('income-month-filter').value;
                
                let filteredIndex = 0;
                let actualIndex = -1;
                
                for (let i = 0; i < currentClinic.income.length; i++) {
                    const item = currentClinic.income[i];
                    if (item.year.toString() === yearFilter && 
                        (monthFilter === 'all' || item.month.toString() === monthFilter)) {
                        if (filteredIndex === index) {
                            actualIndex = i;
                            break;
                        }
                        filteredIndex++;
                    }
                }
                
                if (actualIndex === -1) return;
                
                const incomeData = currentClinic.income[actualIndex];
                document.getElementById('income-month').value = incomeData.month;
                document.getElementById('income-year').value = incomeData.year;
                document.getElementById('income-amount').value = incomeData.amount;
                
                // Tampilkan form
                document.getElementById('income-form').style.display = 'block';
                document.getElementById('add-income-btn').style.display = 'none';
                
                // Simpan index untuk update
                currentEditIndex = actualIndex;
            }
            
            // Simpan data pendapatan
            function saveIncomeData() {
                if (!currentClinic) return;
                
                const month = parseInt(document.getElementById('income-month').value);
                const year = parseInt(document.getElementById('income-year').value);
                const amount = parseInt(document.getElementById('income-amount').value);
                
                if (isNaN(month) || isNaN(year) || isNaN(amount)) {
                    alert('Mohon isi semua field dengan benar');
                    return;
                }
                
                if (currentEditIndex !== null) {
                    // Update existing data
                    currentClinic.income[currentEditIndex] = { month, year, amount };
                    currentEditIndex = null;
                } else {
                    // Add new data
                    // Cek apakah data untuk bulan dan tahun ini sudah ada
                    const existingIndex = currentClinic.income.findIndex(i => i.month === month && i.year === year);
                    if (existingIndex !== -1) {
                        // Jika sudah ada, update data yang ada
                        currentClinic.income[existingIndex] = { month, year, amount };
                    } else {
                        // Jika belum ada, tambahkan data baru
                        currentClinic.income.push({ month, year, amount });
                    }
                }
                
                // Sembunyikan form dan tampilkan tombol add
                document.getElementById('income-form').style.display = 'none';
                document.getElementById('add-income-btn').style.display = 'inline-block';
                
                // Reset form
                document.getElementById('income-month').value = '1';
                document.getElementById('income-year').value = '2024';
                document.getElementById('income-amount').value = '';
                
                // Refresh table
                loadClinicIncome(currentClinic);
                
                alert('Data pendapatan berhasil disimpan!');
            }
            
            // Hapus data pendapatan
            function deleteIncomeData(index) {
                if (!currentClinic) return;
                
                // Find the actual index in the original array
                const yearFilter = document.getElementById('income-year-filter').value;
                const monthFilter = document.getElementById('income-month-filter').value;
                
                let filteredIndex = 0;
                let actualIndex = -1;
                
                for (let i = 0; i < currentClinic.income.length; i++) {
                    const item = currentClinic.income[i];
                    if (item.year.toString() === yearFilter && 
                        (monthFilter === 'all' || item.month.toString() === monthFilter)) {
                        if (filteredIndex === index) {
                            actualIndex = i;
                            break;
                        }
                        filteredIndex++;
                    }
                }
                
                if (actualIndex === -1) return;
                
                if (confirm('Apakah Anda yakin ingin menghapus data pendapatan ini?')) {
                    currentClinic.income.splice(actualIndex, 1);
                    loadClinicIncome(currentClinic);
                                        alert('Data pendapatan berhasil dihapus!');
                }
            }
            
            // Load data realisasi klinik
            function loadClinicRealization(clinic) {
                // Update honor values
                document.getElementById('honor-medis').value = clinic.realization.honor.medis;
                document.getElementById('honor-paramedis').value = clinic.realization.honor.paramedis;
                document.getElementById('honor-pengelola').value = clinic.realization.honor.pengelola;
                
                // Update operational values
                document.getElementById('operational-atk').value = clinic.realization.operational.atk;
                document.getElementById('operational-obat').value = clinic.realization.operational.obat;
                
                // Update modal table
                const modalTbody = document.getElementById('modal-table-body');
                if (modalTbody) {
                    modalTbody.innerHTML = '';
                    
                    clinic.realization.modal.forEach((item, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${item.nama}</td>
                            <td>${item.satuan}</td>
                            <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
                            <td>${item.jumlah}</td>
                            <td>Rp ${item.total.toLocaleString('id-ID')}</td>
                            <td>
                                ${currentUser && currentUser.type === 'minkes' ? `
                                <button class="btn-warning edit-modal-btn" data-index="${index}">Edit</button>
                                <button class="btn-danger delete-modal-btn" data-index="${index}">Hapus</button>
                                ` : ''}
                            </td>
                        `;
                        modalTbody.appendChild(row);
                    });
                    
                    // Setup event listeners untuk tombol edit dan delete
                    if (currentUser && currentUser.type === 'minkes') {
                        document.querySelectorAll('.edit-modal-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                editModalData(index);
                            });
                        });
                        
                        document.querySelectorAll('.delete-modal-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                deleteModalData(index);
                            });
                        });
                    }
                }
            }
            
            // Simpan data honor
            function saveHonorData() {
                if (!currentClinic) return;
                
                const medis = parseInt(document.getElementById('honor-medis').value) || 0;
                const paramedis = parseInt(document.getElementById('honor-paramedis').value) || 0;
                const pengelola = parseInt(document.getElementById('honor-pengelola').value) || 0;
                
                // Update data
                currentClinic.realization.honor.medis = medis;
                currentClinic.realization.honor.paramedis = paramedis;
                currentClinic.realization.honor.pengelola = pengelola;
                
                alert('Data honor berhasil diperbarui!');
            }
            
            // Simpan data operasional
            function saveOperationalData() {
                if (!currentClinic) return;
                
                const atk = parseInt(document.getElementById('operational-atk').value) || 0;
                const obat = parseInt(document.getElementById('operational-obat').value) || 0;
                
                // Update data
                currentClinic.realization.operational.atk = atk;
                currentClinic.realization.operational.obat = obat;
                
                alert('Data operasional berhasil diperbarui!');
            }
            
            // Edit data modal
            function editModalData(index) {
                if (!currentClinic) return;
                
                const modalData = currentClinic.realization.modal[index];
                document.getElementById('modal-name').value = modalData.nama;
                document.getElementById('modal-unit').value = modalData.satuan;
                document.getElementById('modal-price').value = modalData.harga;
                document.getElementById('modal-quantity').value = modalData.jumlah;
                
                // Tampilkan form
                document.getElementById('modal-form').style.display = 'block';
                
                // Simpan index untuk update
                currentEditIndex = index;
            }
            
            // Simpan data modal
            function saveModalData() {
                if (!currentClinic) return;
                
                const name = document.getElementById('modal-name').value;
                const unit = document.getElementById('modal-unit').value;
                const price = parseInt(document.getElementById('modal-price').value);
                const quantity = parseInt(document.getElementById('modal-quantity').value);
                
                if (!name || !unit || isNaN(price) || isNaN(quantity)) {
                    alert('Mohon isi semua field dengan benar');
                    return;
                }
                
                const total = price * quantity;
                
                if (currentEditIndex !== null) {
                    // Update existing data
                    currentClinic.realization.modal[currentEditIndex] = { 
                        id: currentClinic.realization.modal[currentEditIndex].id,
                        nama: name, 
                        satuan: unit, 
                        harga: price, 
                        jumlah: quantity, 
                        total: total 
                    };
                    currentEditIndex = null;
                } else {
                    // Add new data
                    const newId = Date.now();
                    currentClinic.realization.modal.push({ 
                        id: newId,
                        nama: name, 
                        satuan: unit, 
                        harga: price, 
                        jumlah: quantity, 
                        total: total 
                    });
                }
                
                // Sembunyikan form
                document.getElementById('modal-form').style.display = 'none';
                
                // Reset form
                document.getElementById('modal-name').value = '';
                document.getElementById('modal-unit').value = '';
                document.getElementById('modal-price').value = '';
                document.getElementById('modal-quantity').value = '';
                
                // Refresh table
                loadClinicRealization(currentClinic);
                
                alert('Data belanja modal berhasil disimpan!');
            }
            
            // Hapus data modal
            function deleteModalData(index) {
                if (!currentClinic) return;
                
                if (confirm('Apakah Anda yakin ingin menghapus data belanja modal ini?')) {
                    currentClinic.realization.modal.splice(index, 1);
                    loadClinicRealization(currentClinic);
                    alert('Data belanja modal berhasil dihapus!');
                }
            }
            
            // Load data sisa anggaran klinik
            function loadClinicBudget(clinic) {
                // Update total values
                document.getElementById('total-budget').textContent = `Rp ${clinic.budget.totalBudget.toLocaleString('id-ID')}`;
                document.getElementById('total-spent').textContent = `Rp ${clinic.budget.totalSpent.toLocaleString('id-ID')}`;
                document.getElementById('remaining-budget').textContent = `Rp ${clinic.budget.remaining.toLocaleString('id-ID')}`;
                
                const tbody = document.getElementById('budget-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                const yearFilter = document.getElementById('budget-year-filter').value;
                const monthFilter = document.getElementById('budget-month-filter').value;
                
                // Filter data berdasarkan tahun dan bulan
                let filteredBudget = clinic.budget.monthlyRemaining.filter(item => 
                    item.year.toString() === yearFilter
                );
                
                if (monthFilter !== 'all') {
                    filteredBudget = filteredBudget.filter(item => 
                        item.month.toString() === monthFilter
                    );
                }
                
                // Sort by month
                filteredBudget.sort((a, b) => a.month - b.month);
                
                filteredBudget.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${getMonthName(item.month)}</td>
                        <td>${item.year}</td>
                        <td>Rp ${item.budget.toLocaleString('id-ID')}</td>
                        <td>Rp ${item.spent.toLocaleString('id-ID')}</td>
                        <td>Rp ${item.remaining.toLocaleString('id-ID')}</td>
                        <td>
                            ${currentUser && currentUser.type === 'minkes' ? `
                            <button class="btn-warning edit-budget-btn" data-index="${index}">Edit</button>
                            <button class="btn-danger delete-budget-btn" data-index="${index}">Hapus</button>
                            ` : ''}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Setup event listeners untuk tombol edit dan delete
                if (currentUser && currentUser.type === 'minkes') {
                    document.querySelectorAll('.edit-budget-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            editBudgetData(index);
                        });
                    });
                    
                    document.querySelectorAll('.delete-budget-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            deleteBudgetData(index);
                        });
                    });
                }
            }
            
            // Edit data anggaran bulanan
            function editBudgetData(index) {
                if (!currentClinic) return;
                
                // Find the actual index in the original array
                const yearFilter = document.getElementById('budget-year-filter').value;
                const monthFilter = document.getElementById('budget-month-filter').value;
                
                let filteredIndex = 0;
                let actualIndex = -1;
                
                for (let i = 0; i < currentClinic.budget.monthlyRemaining.length; i++) {
                    const item = currentClinic.budget.monthlyRemaining[i];
                    if (item.year.toString() === yearFilter && 
                        (monthFilter === 'all' || item.month.toString() === monthFilter)) {
                        if (filteredIndex === index) {
                            actualIndex = i;
                            break;
                        }
                        filteredIndex++;
                    }
                }
                
                if (actualIndex === -1) return;
                
                const budgetData = currentClinic.budget.monthlyRemaining[actualIndex];
                document.getElementById('budget-month').value = budgetData.month;
                document.getElementById('budget-year').value = budgetData.year;
                document.getElementById('budget-amount').value = budgetData.budget;
                document.getElementById('budget-spent').value = budgetData.spent;
                
                // Tampilkan form
                document.getElementById('budget-form').style.display = 'block';
                document.getElementById('add-budget-btn').style.display = 'none';
                
                // Simpan index untuk update
                currentEditIndex = actualIndex;
            }
            
            // Simpan data anggaran bulanan
            function saveBudgetData() {
                if (!currentClinic) return;
                
                const month = parseInt(document.getElementById('budget-month').value);
                const year = parseInt(document.getElementById('budget-year').value);
                const budget = parseInt(document.getElementById('budget-amount').value);
                const spent = parseInt(document.getElementById('budget-spent').value);
                
                if (isNaN(month) || isNaN(year) || isNaN(budget) || isNaN(spent)) {
                    alert('Mohon isi semua field dengan benar');
                    return;
                }
                
                const remaining = budget - spent;
                
                if (currentEditIndex !== null) {
                    // Update existing data
                    currentClinic.budget.monthlyRemaining[currentEditIndex] = { 
                        month, 
                        year, 
                        budget, 
                        spent, 
                        remaining 
                    };
                    currentEditIndex = null;
                } else {
                    // Add new data
                    // Cek apakah data untuk bulan dan tahun ini sudah ada
                    const existingIndex = currentClinic.budget.monthlyRemaining.findIndex(b => b.month === month && b.year === year);
                    if (existingIndex !== -1) {
                        // Jika sudah ada, update data yang ada
                        currentClinic.budget.monthlyRemaining[existingIndex] = { month, year, budget, spent, remaining };
                    } else {
                        // Jika belum ada, tambahkan data baru
                        currentClinic.budget.monthlyRemaining.push({ month, year, budget, spent, remaining });
                    }
                }
                
                // Sembunyikan form dan tampilkan tombol add
                document.getElementById('budget-form').style.display = 'none';
                document.getElementById('add-budget-btn').style.display = 'inline-block';
                
                // Reset form
                document.getElementById('budget-month').value = '1';
                document.getElementById('budget-year').value = '2024';
                document.getElementById('budget-amount').value = '';
                document.getElementById('budget-spent').value = '';
                
                // Refresh table
                loadClinicBudget(currentClinic);
                
                alert('Data anggaran bulanan berhasil disimpan!');
            }
            
            // Hapus data anggaran bulanan
            function deleteBudgetData(index) {
                if (!currentClinic) return;
                
                // Find the actual index in the original array
                const yearFilter = document.getElementById('budget-year-filter').value;
                const monthFilter = document.getElementById('budget-month-filter').value;
                
                let filteredIndex = 0;
                let actualIndex = -1;
                
                for (let i = 0; i < currentClinic.budget.monthlyRemaining.length; i++) {
                    const item = currentClinic.budget.monthlyRemaining[i];
                    if (item.year.toString() === yearFilter && 
                        (monthFilter === 'all' || item.month.toString() === monthFilter)) {
                        if (filteredIndex === index) {
                            actualIndex = i;
                            break;
                        }
                        filteredIndex++;
                    }
                }
                
                if (actualIndex === -1) return;
                
                if (confirm('Apakah Anda yakin ingin menghapus data anggaran bulanan ini?')) {
                    currentClinic.budget.monthlyRemaining.splice(actualIndex, 1);
                    loadClinicBudget(currentClinic);
                    alert('Data anggaran bulanan berhasil dihapus!');
                }
            }
            
            // Load form edit klinik
            function loadClinicEditForm(clinic) {
                document.getElementById('edit-clinic-id').value = clinic.id;
                document.getElementById('edit-clinic-name').value = clinic.name;
                document.getElementById('edit-clinic-address').value = clinic.address;
                document.getElementById('edit-clinic-phone').value = clinic.phone;
                document.getElementById('edit-clinic-email').value = clinic.email;
                
                // Tampilkan preview gambar
                const imagePreview = document.getElementById('edit-clinic-image-preview');
                if (imagePreview) {
                    imagePreview.src = clinic.image;
                    imagePreview.style.display = 'block';
                }
            }
            
            // Simpan edit klinik
            function saveClinicEdit() {
                if (!currentClinic) return;
                
                const clinicId = parseInt(document.getElementById('edit-clinic-id').value);
                const clinicIndex = clinics.findIndex(c => c.id === clinicId);
                
                if (clinicIndex === -1) return;
                
                // Update data klinik
                clinics[clinicIndex].name = document.getElementById('edit-clinic-name').value;
                clinics[clinicIndex].address = document.getElementById('edit-clinic-address').value;
                clinics[clinicIndex].phone = document.getElementById('edit-clinic-phone').value;
                clinics[clinicIndex].email = document.getElementById('edit-clinic-email').value;
                
                // Update gambar jika ada file baru yang diupload
                const imageInput = document.getElementById('edit-clinic-image');
                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        clinics[clinicIndex].image = e.target.result;
                        // Update currentClinic
                        currentClinic.image = e.target.result;
                        
                        // Update gambar di detail klinik
                        const clinicImage = document.getElementById('clinic-image');
                        if (clinicImage) {
                            clinicImage.src = e.target.result;
                        }
                        
                        // Tampilkan pesan sukses
                        alert('Data klinik berhasil diperbarui!');
                        
                        // Kembali ke info klinik
                        showClinicInfo();
                    };
                    reader.readAsDataURL(imageInput.files[0]);
                } else {
                    // Jika tidak ada gambar baru, langsung update
                    // Update currentClinic
                    currentClinic.name = clinics[clinicIndex].name;
                    currentClinic.address = clinics[clinicIndex].address;
                    currentClinic.phone = clinics[clinicIndex].phone;
                    currentClinic.email = clinics[clinicIndex].email;
                    
                    // Tampilkan pesan sukses
                    alert('Data klinik berhasil diperbarui!');
                    
                    // Kembali ke info klinik
                    showClinicInfo();
                    
                    // Refresh daftar klinik
                    loadClinics();
                }
            }
            
            // Load data rekap
            function loadRecapData() {
                const tbody = document.getElementById('recap-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                const yearFilter = document.getElementById('recap-year-filter').value;
                const monthFilter = document.getElementById('recap-month-filter').value;
                
                clinics.forEach((clinic, index) => {
                    let totalBudget = 0;
                    let totalRealization = 0;
                    
                    if (monthFilter === 'all') {
                        // Sum all months for the year
                        clinic.budget.monthlyRemaining.forEach(item => {
                            if (item.year.toString() === yearFilter) {
                                totalBudget += item.budget;
                                totalRealization += item.spent;
                            }
                        });
                    } else {
                        // Get specific month
                        const budgetData = clinic.budget.monthlyRemaining.find(item => 
                            item.year.toString() === yearFilter && item.month.toString() === monthFilter
                        );
                        
                        if (budgetData) {
                            totalBudget = budgetData.budget;
                            totalRealization = budgetData.spent;
                        }
                    }
                    
                    const remaining = totalBudget - totalRealization;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${clinic.name}</td>
                        <td>Rp ${totalBudget.toLocaleString('id-ID')}</td>
                        <td>Rp ${totalRealization.toLocaleString('id-ID')}</td>
                        <td>Rp ${remaining.toLocaleString('id-ID')}</td>
                        <td>
                            <button class="btn-success view-recap-btn" data-id="${clinic.id}">Detail</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Setup event listeners untuk tombol detail
                document.querySelectorAll('.view-recap-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const clinicId = parseInt(this.getAttribute('data-id'));
                        viewClinic(clinicId);
                    });
                });
            }
            
            // Download Excel report
            function downloadExcelReport() {
                const year = document.getElementById('recap-year-filter').value;
                const monthFilter = document.getElementById('recap-month-filter').value;
                
                let csvContent = "text/csv;charset=utf-8,";
                csvContent += "LAPORAN REKAPITULASI ANGGARAN FKTP DENKESYAH 02.04.03\n\n";
                csvContent += `Tahun: ${year}\n`;
                csvContent += `Bulan: ${monthFilter === 'all' ? 'Semua Bulan' : getMonthName(parseInt(monthFilter))}\n\n`;
                
                // Headers
                csvContent += "No,Nama Klinik,Total Anggaran,Total Realisasi,Sisa Anggaran,Persentase Realisasi\n";
                
                // Data
                clinics.forEach((clinic, index) => {
                    let totalBudget = 0;
                    let totalRealization = 0;
                    
                    if (monthFilter === 'all') {
                        clinic.budget.monthlyRemaining.forEach(item => {
                            if (item.year.toString() === year) {
                                totalBudget += item.budget;
                                totalRealization += item.spent;
                            }
                        });
                    } else {
                        const budgetData = clinic.budget.monthlyRemaining.find(item => 
                            item.year.toString() === year && item.month.toString() === monthFilter
                        );
                        
                        if (budgetData) {
                            totalBudget = budgetData.budget;
                            totalRealization = budgetData.spent;
                        }
                    }
                    
                    const remaining = totalBudget - totalRealization;
                    const percentage = totalBudget > 0 ? Math.round((totalRealization / totalBudget) * 100) : 0;
                    
                    csvContent += `${index + 1},${clinic.name},${totalBudget},${totalRealization},${remaining},${percentage}%\n`;
                });
                
                // Create download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `Rekap_Anggaran_FKTP_${year}_${monthFilter === 'all' ? 'SemuaBulan' : getMonthName(parseInt(monthFilter))}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('Laporan Excel berhasil diunduh!');
            }
            
            // Download PowerPoint report (simulated)
            function downloadPowerPointReport() {
                alert('Fitur export ke PowerPoint akan tersedia di versi berikutnya.\n\nUntuk saat ini, Anda dapat menggunakan laporan Excel yang telah diunduh.');
            }
        </script>
    </body>
</html>
