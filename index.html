<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FKTP DENKESYAH 02.04.03</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #1e3a8a;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #64748b;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4b5563;
        }
        
        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="number"],
        textarea,
        select,
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        button {
            background-color: #2563eb;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #1d4ed8;
        }
        
        .btn-secondary {
            background-color: #6b7280;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        .btn-success {
            background-color: #059669;
        }
        
        .btn-success:hover {
            background-color: #047857;
        }
        
        .btn-danger {
            background-color: #dc2626;
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
        }
        
        .btn-warning {
            background-color: #d97706;
        }
        
        .btn-warning:hover {
            background-color: #b45309;
        }
        
        .btn-info {
            background-color: #0891b2;
        }
        
        .btn-info:hover {
            background-color: #0e7490;
        }
        
        .btn-export {
            background-color: #7c3aed;
        }
        
        .btn-export:hover {
            background-color: #6d28d9;
        }
        
        .help-section {
            background-color: #dbeafe;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .error {
            background-color: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            display: none;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .clinic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .clinic-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .clinic-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #1e3a8a;
        }
        
        .clinic-detail {
            margin-bottom: 5px;
            color: #4b5563;
            font-size: 14px;
        }
        
        .clinic-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background-color: #f8fafc;
            font-weight: bold;
            color: #1e3a8a;
        }
        
        tr:hover {
            background-color: #f8fafc;
        }
        
        /* Form Styles */
        .form-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .nav-buttons {
                justify-content: center;
            }
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-top: 4px solid #2563eb;
        }
        
        .stat-card.honor {
            border-top-color: #059669;
        }
        
        .stat-card.operational {
            border-top-color: #d97706;
        }
        
        .stat-card.modal {
            border-top-color: #7c3aed;
        }
        
        .stat-title {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
        }
        
        .stat-value.honor {
            color: #059669;
        }
        
        .stat-value.operational {
            color: #d97706;
        }
        
        .stat-value.modal {
            color: #7c3aed;
        }
        
        /* Progress Bars */
        .progress-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 10px;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 9999px;
            background-color: #2563eb;
        }
        
        .progress-honor {
            background-color: #059669;
        }
        
        .progress-operational {
            background-color: #d97706;
        }
        
        .progress-modal {
            background-color: #7c3aed;
        }
        
        /* Finance Form */
        .finance-form {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }
        
        .finance-form h4 {
            margin-bottom: 20px;
            color: #1e3a8a;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .modal-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
        }
        
        .modal-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .remove-item-btn {
            background-color: #dc2626;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .add-item-btn {
            background-color: #059669;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 20px 0;
        }
        
        .finance-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        /* Filter Section */
        .filter-section {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-item {
            flex: 1;
            min-width: 200px;
        }
        
        /* Image Upload */
        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
        }
        
        .image-upload {
            border: 2px dashed #d1d5db;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-upload:hover {
            border-color: #2563eb;
            background-color: #f0f7ff;
        }
        
        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: flex-end;
        }
        
        /* Chart Container */
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 30px 0;
            position: relative;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
        }
        
        /* Download Links */
        .download-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #7c3aed;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        
        .download-link:hover {
            background-color: #6d28d9;
        }
        
        .download-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border: 1px solid #e2e8f0;
        }
        
        .download-section h4 {
            margin-bottom: 20px;
            color: #1e3a8a;
        }
        
        /* Monthly Report Tabs */
        .monthly-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }
        
        .monthly-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            background: none;
            font-weight: 500;
        }
        
        .monthly-tab.active {
            border-color: #e5e7eb;
            border-bottom-color: white;
            background: white;
            border-radius: 6px 6px 0 0;
        }
        
        .monthly-tab:hover:not(.active) {
            background: #f8fafc;
        }
        
        .monthly-content {
            display: none;
        }
        
        .monthly-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="login-section" class="login-container">
            <div class="header">
                <h1>FKTP DENKESYAH 02.04.03</h1>
                <p>www.FKTPDenkesyahLampung.com</p>
            </div>
            
            <div class="help-section">
                <h3>Petunjuk Login:</h3>
                <p>• Username: minkes, Password: minkes123 (untuk akses minkes)</p>
                <p>• Username: klinik, Password: klinik123 (untuk akses klinik)</p>
                <p>• Username: user, Password: user123 (untuk akses user biasa)</p>
            </div>
            
            <div id="error-message" class="error">
                Username atau password salah
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                
                <button type="submit">Login</button>
            </form>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="dashboard">
            <div class="dashboard-header">
                <div>
                    <h2>Dashboard FKTP DENKESYAH 02.04.03</h2>
                    <p id="user-display">Halo, User</p>
                </div>
                <div class="nav-buttons">
                    <button id="btn-dashboard">Dashboard</button>
                    <button id="btn-clinics">Daftar Klinik</button>
                    <button id="btn-recap">Rekap Total</button>
                    <button id="logout-btn" class="btn-danger">Logout</button>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div id="dashboard-content" class="content" style="display: block;">
                <h3>Selamat Datang di Sistem Manajemen FKTP</h3>
                <p>Anda login sebagai: <strong id="user-type-display">-</strong></p>
                <p>Silakan pilih menu di atas untuk mengakses fitur-fitur sistem.</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Total Klinik</div>
                        <div class="stat-value" id="total-clinics">10</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Total Pendapatan</div>
                        <div class="stat-value" id="total-income">Rp 1.500.000.000</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Total Realisasi</div>
                        <div class="stat-value" id="total-realization">Rp 1.200.000.000</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Sisa Anggaran</div>
                        <div class="stat-value" id="total-remaining">Rp 300.000.000</div>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div class="filter-row">
                        <div class="filter-item">
                            <label for="dashboard-year-filter">Tahun</label>
                            <select id="dashboard-year-filter">
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="filter-item">
                            <label for="dashboard-month-filter">Bulan</label>
                            <select id="dashboard-month-filter">
                                <option value="all">Semua Bulan</option>
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Maret</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Juni</option>
                                <option value="7">Juli</option>
                                <option value="8">Agustus</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <h4>Rekapan Anggaran Per Bulan</h4>
                <div class="chart-container">
                    <canvas id="budget-chart"></canvas>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Bulan</th>
                            <th>Total Anggaran</th>
                            <th>Total Realisasi</th>
                            <th>Sisa Anggaran</th>
                            <th>Persentase Realisasi</th>
                        </tr>
                    </thead>
                    <tbody id="dashboard-budget-table">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Clinics Content -->
            <div id="clinics-content" class="content" style="display: none;">
                <h3>Daftar Unit FKTP</h3>
                <p>Klik pada klinik untuk melihat detail, laporan, dan melakukan edit (jika memiliki akses).</p>
                
                <div class="clinic-grid" id="clinics-container">
                    <!-- Daftar klinik akan muncul di sini -->
                </div>
            </div>
            
            <!-- Clinic Detail Content -->
            <div id="clinic-detail-content" class="content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="clinic-detail-title">Detail Klinik</h3>
                    <button id="back-to-clinics" class="btn-secondary">← Kembali ke Daftar Klinik</button>
                </div>
                
                <div class="nav-buttons" style="margin-bottom: 20px;">
                    <button id="btn-clinic-info" class="btn-secondary">Informasi Klinik</button>
                    <button id="btn-clinic-income" class="btn-secondary">Laporan Pendapatan</button>
                    <button id="btn-clinic-realization" class="btn-secondary">Realisasi Pendapatan</button>
                    <button id="btn-clinic-budget" class="btn-secondary">Sisa Anggaran</button>
                    <button id="btn-clinic-finance" class="btn-info">Input/Update Keuangan</button>
                    <button id="btn-clinic-edit" class="btn-warning" style="display: none;">Edit Klinik</button>
                </div>
                
                <!-- Clinic Info Section -->
                <div id="clinic-info-section">
                    <div class="form-row">
                        <div>
                            <h4>Informasi Dasar</h4>
                            <p><strong>Nama:</strong> <span id="clinic-name">-</span></p>
                            <p><strong>Alamat:</strong> <span id="clinic-address">-</span></p>
                            <p><strong>Telepon:</strong> <span id="clinic-phone">-</span></p>
                            <p><strong>Email:</strong> <span id="clinic-email">-</span></p>
                        </div>
                        <div>
                            <h4>Gambar Klinik</h4>
                            <img id="clinic-image" class="image-preview" src="" alt="Gambar Klinik">
                        </div>
                    </div>
                </div>
                
                <!-- Income Report Section -->
                <div id="clinic-income-section" style="display: none;">
                    <h4>Laporan Pendapatan Kapitasi BPJS</h4>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-item">
                                <label for="income-year-filter">Tahun</label>
                                <select id="income-year-filter">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="income-month-filter">Bulan</label>
                                <select id="income-month-filter">
                                    <option value="all">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="monthly-tabs">
                        <div class="monthly-tab active" data-tab="monthly">Per Bulan</div>
                        <div class="monthly-tab" data-tab="yearly">Per Tahun</div>
                    </div>
                    
                    <div id="income-monthly-content" class="monthly-content active">
                        <h5>Laporan Pendapatan Per Bulan</h5>
                        <table>
                            <thead>
                                <tr>
                                    <th>Bulan</th>
                                    <th>Tahun</th>
                                    <th>Jumlah Pendapatan (Rp)</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="income-table-body">
                                <!-- Data pendapatan per bulan akan muncul di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="income-yearly-content" class="monthly-content">
                        <h5>Laporan Pendapatan Per Tahun</h5>
                        <table>
                            <thead>
                                <tr>
                                    <th>Tahun</th>
                                    <th>Total Pendapatan (Rp)</th>
                                    <th>Rata-rata Per Bulan (Rp)</th>
                                </tr>
                            </thead>
                            <tbody id="income-yearly-table-body">
                                <!-- Data pendapatan per tahun akan muncul di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <button id="add-income-btn" class="add-item-btn" style="display: none;">+ Tambah Data Pendapatan</button>
                    <div id="income-form-container" style="display: none;" class="finance-form">
                        <h4>Form Input Pendapatan</h4>
                        <div class="form-row">
                            <div>
                                <label for="income-month">Bulan</label>
                                <select id="income-month">
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                            <div>
                                <label for="income-year">Tahun</label>
                                <select id="income-year">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="income-amount">Jumlah Pendapatan (Rp)</label>
                                <input type="number" id="income-amount" min="0" placeholder="Masukkan jumlah pendapatan">
                            </div>
                        </div>
                        <div class="finance-actions">
                            <button type="button" id="cancel-income-btn" class="btn-secondary">Batal</button>
                            <button type="button" id="save-income-btn" class="btn-success">Simpan</button>
                        </div>
                    </div>
                </div>
                
                <!-- Realization Report Section -->
                <div id="clinic-realization-section" style="display: none;">
                    <h4>Realisasi Pendapatan</h4>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-item">
                                <label for="realization-year-filter">Tahun</label>
                                <select id="realization-year-filter">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="realization-month-filter">Bulan</label>
                                <select id="realization-month-filter">
                                    <option value="all">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="monthly-tabs">
                        <div class="monthly-tab active" data-tab="monthly">Per Bulan</div>
                        <div class="monthly-tab" data-tab="yearly">Per Tahun</div>
                    </div>
                    
                    <div id="realization-monthly-content" class="monthly-content active">
                        <h5>Realisasi Pendapatan Per Bulan</h5>
                        <div class="finance-form">
                            <h4>Honor/Jasa (30%)</h4>
                            <div class="form-row">
                                <div>
                                    <label for="honor-medis">Medis (Rp)</label>
                                    <input type="number" id="honor-medis-input" min="0" placeholder="Masukkan jumlah">
                                </div>
                                <div>
                                    <label for="honor-paramedis">Paramedis (Rp)</label>
                                    <input type="number" id="honor-paramedis-input" min="0" placeholder="Masukkan jumlah">
                                </div>
                                <div>
                                    <label for="honor-pengelola">Pengelola (Rp)</label>
                                    <input type="number" id="honor-pengelola-input" min="0" placeholder="Masukkan jumlah">
                                </div>
                            </div>
                            <div class="finance-actions">
                                <button type="button" id="save-honor-btn" class="btn-success">Update Honor</button>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card honor">
                                <div class="stat-title">Medis</div>
                                <div class="stat-value honor" id="honor-medis-display">Rp 0</div>
                            </div>
                            <div class="stat-card honor">
                                <div class="stat-title">Paramedis</div>
                                <div class="stat-value honor" id="honor-paramedis-display">Rp 0</div>
                            </div>
                            <div class="stat-card honor">
                                <div class="stat-title">Pengelola</div>
                                <div class="stat-value honor" id="honor-pengelola-display">Rp 0</div>
                            </div>
                        </div>
                        
                        <div class="finance-form">
                            <h4>Operasional (50%)</h4>
                            <div class="form-row">
                                <div>
                                    <label for="operational-atk">Belanja ATK (Rp)</label>
                                    <input type="number" id="operational-atk-input" min="0" placeholder="Masukkan jumlah">
                                </div>
                                <div>
                                    <label for="operational-obat">Belanja Obat (Rp)</label>
                                    <input type="number" id="operational-obat-input" min="0" placeholder="Masukkan jumlah">
                                </div>
                            </div>
                            <div class="finance-actions">
                                <button type="button" id="save-operational-btn" class="btn-success">Update Operasional</button>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card operational">
                                <div class="stat-title">Belanja ATK</div>
                                <div class="stat-value operational" id="operational-atk-display">Rp 0</div>
                            </div>
                            <div class="stat-card operational">
                                <div class="stat-title">Belanja Obat</div>
                                <div class="stat-value operational" id="operational-obat-display">Rp 0</div>
                            </div>
                        </div>
                        
                        <div class="finance-form">
                            <h4>Belanja Modal (20%)</h4>
                            <button id="add-modal-item-btn" class="add-item-btn">+ Tambah Item Belanja Modal</button>
                            <div id="modal-form-container" style="display: none;" class="finance-form">
                                <h4>Form Input Item Belanja Modal</h4>
                                <div class="form-row">
                                    <div>
                                        <label for="modal-item-name">Nama Barang</label>
                                        <input type="text" id="modal-item-name" placeholder="Masukkan nama barang">
                                    </div>
                                    <div>
                                        <label for="modal-item-unit">Satuan</label>
                                        <input type="text" id="modal-item-unit" placeholder="Masukkan satuan">
                                    </div>
                                    <div>
                                        <label for="modal-item-price">Harga (Rp)</label>
                                        <input type="number" id="modal-item-price" min="0" placeholder="Masukkan harga">
                                    </div>
                                    <div>
                                        <label for="modal-item-quantity">Jumlah</label>
                                        <input type="number" id="modal-item-quantity" min="1" placeholder="Masukkan jumlah">
                                    </div>
                                </div>
                                <div class="finance-actions">
                                    <button type="button" id="cancel-modal-btn" class="btn-secondary">Batal</button>
                                    <button type="button" id="save-modal-btn" class="btn-success">Simpan Item</button>
                                </div>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Barang</th>
                                    <th>Satuan</th>
                                    <th>Harga</th>
                                    <th>Jumlah</th>
                                    <th>Total</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="modal-table-body">
                                <!-- Data belanja modal akan muncul di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="realization-yearly-content" class="monthly-content">
                        <h5>Realisasi Pendapatan Per Tahun</h5>
                        <table>
                            <thead>
                                <tr>
                                    <th>Tahun</th>
                                    <th>Honor/Jasa (Rp)</th>
                                    <th>Operasional (Rp)</th>
                                    <th>Belanja Modal (Rp)</th>
                                    <th>Total Realisasi (Rp)</th>
                                </tr>
                            </thead>
                            <tbody id="realization-yearly-table-body">
                                <!-- Data realisasi per tahun akan muncul di sini -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Budget Remaining Section -->
                <div id="clinic-budget-section" style="display: none;">
                    <h4>Sisa Anggaran</h4>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-item">
                                <label for="budget-year-filter">Tahun</label>
                                <select id="budget-year-filter">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="budget-month-filter">Bulan</label>
                                <select id="budget-month-filter">
                                    <option value="all">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="monthly-tabs">
                        <div class="monthly-tab active" data-tab="monthly">Per Bulan</div>
                        <div class="monthly-tab" data-tab="yearly">Per Tahun</div>
                    </div>
                    
                    <div id="budget-monthly-content" class="monthly-content active">
                        <h5>Sisa Anggaran Per Bulan</h5>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-title">Total Anggaran</div>
                                <div class="stat-value" id="total-budget">Rp 0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-title">Telah Digunakan</div>
                                <div class="stat-value" id="total-spent">Rp 0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-title">Sisa Anggaran</div>
                                <div class="stat-value" id="remaining-budget">Rp 0</div>
                            </div>
                        </div>
                        
                        <h5>Persentase Penggunaan per Kategori</h5>
                        <div style="margin: 20px 0;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Honor/Jasa (30%)</span>
                                    <span id="honor-percentage">0%</span>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar progress-honor" id="honor-progress" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Operasional (50%)</span>
                                    <span id="operational-percentage">0%</span>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar progress-operational" id="operational-progress" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Belanja Modal (20%)</span>
                                    <span id="modal-percentage">0%</span>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar progress-modal" id="modal-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>Bulan</th>
                                    <th>Tahun</th>
                                    <th>Total Anggaran</th>
                                    <th>Telah Digunakan</th>
                                    <th>Sisa Anggaran</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-budget-body">
                                <!-- Data sisa anggaran bulanan akan muncul di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="budget-yearly-content" class="monthly-content">
                        <h5>Sisa Anggaran Per Tahun</h5>
                        <table>
                            <thead>
                                <tr>
                                    <th>Tahun</th>
                                    <th>Total Anggaran (Rp)</th>
                                    <th>Total Realisasi (Rp)</th>
                                    <th>Sisa Anggaran (Rp)</th>
                                    <th>Persentase Realisasi</th>
                                </tr>
                            </thead>
                            <tbody id="budget-yearly-table-body">
                                <!-- Data sisa anggaran per tahun akan muncul di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <button id="add-budget-btn" class="add-item-btn" style="display: none;">+ Tambah Data Anggaran Bulanan</button>
                    <div id="budget-form-container" style="display: none;" class="finance-form">
                        <h4>Form Input Anggaran Bulanan</h4>
                        <div class="form-row">
                            <div>
                                <label for="budget-month">Bulan</label>
                                <select id="budget-month">
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                            <div>
                                <label for="budget-year">Tahun</label>
                                <select id="budget-year">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="budget-amount">Total Anggaran (Rp)</label>
                                <input type="number" id="budget-amount" min="0" placeholder="Masukkan total anggaran">
                            </div>
                            <div>
                                <label for="budget-spent">Telah Digunakan (Rp)</label>
                                <input type="number" id="budget-spent" min="0" placeholder="Masukkan yang telah digunakan">
                            </div>
                        </div>
                        <div class="finance-actions">
                            <button type="button" id="cancel-budget-btn" class="btn-secondary">Batal</button>
                            <button type="button" id="save-budget-btn" class="btn-success">Simpan</button>
                        </div>
                    </div>
                </div>
                
                <!-- Finance Input/Update Section -->
                <div id="clinic-finance-section" style="display: none;">
                    <h4>Input/Update Data Keuangan</h4>
                    <p>Gunakan form di bawah ini untuk menginput atau mengupdate data keuangan klinik.</p>
                    
                    <div class="finance-form">
                        <h4>Update Total Anggaran</h4>
                        <div class="form-row">
                            <div>
                                <label for="total-budget-input">Total Anggaran (Rp)</label>
                                <input type="number" id="total-budget-input" min="0" placeholder="Masukkan total anggaran">
                            </div>
                        </div>
                        <div class="finance-actions">
                            <button type="button" id="save-total-budget-btn" class="btn-success">Update Total Anggaran</button>
                        </div>
                    </div>
                    
                    <div class="finance-form">
                        <h4>Update Alokasi Anggaran per Kategori</h4>
                        <div class="form-row">
                            <div>
                                <label for="honor-allocated">Alokasi Honor/Jasa (Rp)</label>
                                <input type="number" id="honor-allocated-input" min="0" placeholder="Masukkan alokasi">
                            </div>
                            <div>
                                <label for="operational-allocated">Alokasi Operasional (Rp)</label>
                                <input type="number" id="operational-allocated-input" min="0" placeholder="Masukkan alokasi">
                            </div>
                            <div>
                                <label for="modal-allocated">Alokasi Belanja Modal (Rp)</label>
                                <input type="number" id="modal-allocated-input" min="0" placeholder="Masukkan alokasi">
                            </div>
                        </div>
                        <div class="finance-actions">
                            <button type="button" id="save-allocated-budget-btn" class="btn-success">Update Alokasi Anggaran</button>
                        </div>
                    </div>
                    
                    <div class="finance-form">
                        <h4>Update Realisasi Anggaran per Kategori</h4>
                        <div class="form-row">
                            <div>
                                <label for="honor-spent">Realisasi Honor/Jasa (Rp)</label>
                                <input type="number" id="honor-spent-input" min="0" placeholder="Masukkan realisasi">
                            </div>
                            <div>
                                <label for="operational-spent">Realisasi Operasional (Rp)</label>
                                <input type="number" id="operational-spent-input" min="0" placeholder="Masukkan realisasi">
                            </div>
                            <div>
                                <label for="modal-spent">Realisasi Belanja Modal (Rp)</label>
                                <input type="number" id="modal-spent-input" min="0" placeholder="Masukkan realisasi">
                            </div>
                        </div>
                        <div class="finance-actions">
                            <button type="button" id="save-spent-budget-btn" class="btn-success">Update Realisasi Anggaran</button>
                        </div>
                    </div>
                </div>
                
                <!-- Edit Clinic Form -->
                <div id="clinic-edit-section" style="display: none;">
                    <h4>Edit Informasi Klinik</h4>
                    <form id="edit-clinic-form">
                        <input type="hidden" id="edit-clinic-id">
                        <div class="form-row">
                            <div>
                                <label for="edit-clinic-name">Nama Klinik</label>
                                <input type="text" id="edit-clinic-name" required>
                            </div>
                            <div>
                                <label for="edit-clinic-address">Alamat</label>
                                <input type="text" id="edit-clinic-address" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label for="edit-clinic-phone">Telepon</label>
                                <input type="text" id="edit-clinic-phone" required>
                            </div>
                            <div>
                                <label for="edit-clinic-email">Email</label>
                                <input type="email" id="edit-clinic-email" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit-clinic-image">Upload Gambar Klinik</label>
                            <div class="image-upload" id="image-upload-area">
                                <p>Klik atau drag file gambar ke sini</p>
                                <p>Format yang didukung: JPG, PNG, GIF</p>
                            </div>
                            <input type="file" id="edit-clinic-image" accept="image/*" style="display: none;">
                            <img id="edit-clinic-image-preview" class="image-preview" src="" alt="Preview Gambar">
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn-success">Simpan Perubahan</button>
                            <button type="button" id="cancel-edit" class="btn-secondary">Batal</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Total Recap Content -->
            <div id="recap-content" class="content" style="display: none;">
                <h3>Rekap Total Semua Unit FKTP</h3>
                
                <div class="filter-section">
                    <div class="filter-row">
                        <div class="filter-item">
                            <label for="recap-year-filter">Tahun</label>
                            <select id="recap-year-filter">
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="filter-item">
                            <label for="recap-month-filter">Bulan</label>
                            <select id="recap-month-filter">
                                <option value="all">Semua Bulan</option>
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Maret</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Juni</option>
                                <option value="7">Juli</option>
                                <option value="8">Agustus</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="download-section">
                    <h4>Download Laporan</h4>
                    <div>
                        <a href="#" id="download-excel" class="download-link">Download Excel</a>
                        <a href="#" id="download-powerpoint" class="download-link">Download PowerPoint</a>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="recap-chart"></canvas>
                </div>
                
                <h4>Rekap per Unit FKTP</h4>
                <table>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Unit</th>
                            <th>Total Pendapatan</th>
                            <th>Total Realisasi</th>
                            <th>Sisa</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="recap-table-body">
                        <!-- Data rekap akan muncul di sini -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Chart.js Library -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script>
            // Generate years for 2 years back and 5 years forward
            function generateYears() {
                const currentYear = new Date().getFullYear();
                const years = [];
                
                // 2 years back
                for (let i = 2; i >= 1; i--) {
                    years.push(currentYear - i);
                }
                
                // Current year
                years.push(currentYear);
                
                // 5 years forward
                for (let i = 1; i <= 5; i++) {
                    years.push(currentYear + i);
                }
                
                return years;
            }
            
            // Get month name from month number
            function getMonthName(monthNumber) {
                const months = [
                    'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                    'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
                ];
                return months[monthNumber - 1];
            }
            
            // Default clinic images
            const defaultClinicImages = [
                'https://placehold.co/600x400/1e3a8a/ffffff?text=Klinik+Gatam+Kedaton',
                'https://placehold.co/600x400/059669/ffffff?text=Polkes+02.10.08+Metro',
                'https://placehold.co/600x400/d97706/ffffff?text=Polkes+02.10.09+Kotabumi',
                'https://placehold.co/600x400/7c3aed/ffffff?text=Polkes+02.10.15+Kalianda',
                'https://placehold.co/600x400/dc2626/ffffff?text=Polkes+02.10.16+Liwa',
                'https://placehold.co/600x400/0891b2/ffffff?text=Polkes+02.10.17+Tanggamus',
                'https://placehold.co/600x400/6b7280/ffffff?text=Polkesdim+0426+Tulang+Bawang',
                'https://placehold.co/600x400/059669/ffffff?text=Polkesdim+0427+Way+Kanan',
                'https://placehold.co/600x400/7c3aed/ffffff?text=Polkesdim+0429+Lamtim',
                'https://placehold.co/600x400/dc2626/ffffff?text=Klinik+Tonkes+Yonif+143/TWEJ'
            ];
            
            // Data klinik dengan 10 klinik yang diminta
            let clinics = [
                { 
                    id: 1, 
                    name: 'Klinik Gatam Kedaton', 
                    address: 'Jl. Gatot Subroto No. 123, Kedaton, Bandar Lampung', 
                    phone: '0721-1234567', 
                    email: 'gatamkedaton@fktpdenkesyah.com',
                    image: defaultClinicImages[0],
                    income: [],
                    realization: {
                        honor: { medis: 30000000, paramedis: 15000000, pengelola: 10000000 },
                        operational: { atk: 25000000, obat: 55000000 },
                        modal: [
                            { id: 1, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 5, total: 2500000 },
                            { id: 2, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 10, total: 3000000 },
                            { id: 3, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 165000000,
                        totalSpent: 120000000,
                        remaining: 45000000,
                        byCategory: {
                            honor: { allocated: 49500000, spent: 45000000, remaining: 4500000 },
                            operational: { allocated: 82500000, spent: 80000000, remaining: 2500000 },
                            modal: { allocated: 33000000, spent: 25000000, remaining: 8000000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 2, 
                    name: 'Polkes 02.10.08 Metro', 
                    address: 'Jl. Jenderal Sudirman No. 45, Metro', 
                    phone: '0725-2345678', 
                    email: 'polkes021008@fktpdenkesyah.com',
                    image: defaultClinicImages[1],
                    income: [],
                    realization: {
                        honor: { medis: 28000000, paramedis: 14000000, pengelola: 9000000 },
                        operational: { atk: 24000000, obat: 53000000 },
                        modal: [
                            { id: 4, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 4, total: 2000000 },
                            { id: 5, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 8, total: 2400000 },
                            { id: 6, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 158000000,
                        totalSpent: 115000000,
                        remaining: 43000000,
                        byCategory: {
                            honor: { allocated: 47400000, spent: 42000000, remaining: 5400000 },
                            operational: { allocated: 79000000, spent: 75000000, remaining: 4000000 },
                            modal: { allocated: 31600000, spent: 28000000, remaining: 3600000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 3, 
                    name: 'Polkes 02.10.09 Kotabumi', 
                    address: 'Jl. Raya Kotabumi No. 78, Kotabumi', 
                    phone: '0724-3456789', 
                    email: 'polkes021009@fktpdenkesyah.com',
                    image: defaultClinicImages[2],
                    income: [],
                    realization: {
                        honor: { medis: 29000000, paramedis: 14500000, pengelola: 9500000 },
                        operational: { atk: 24500000, obat: 54000000 },
                        modal: [
                            { id: 7, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 6, total: 3000000 },
                            { id: 8, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 12, total: 3600000 },
                            { id: 9, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 4, total: 3200000 }
                        ]
                    },
                    budget: {
                        totalBudget: 162000000,
                        totalSpent: 118000000,
                        remaining: 44000000,
                        byCategory: {
                            honor: { allocated: 48600000, spent: 44000000, remaining: 4600000 },
                            operational: { allocated: 81000000, spent: 78000000, remaining: 3000000 },
                            modal: { allocated: 32400000, spent: 26000000, remaining: 6400000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 4, 
                    name: 'Polkes 02.10.15 Kalianda', 
                    address: 'Jl. Raya Kalianda No. 23, Kalianda', 
                    phone: '0727-4567890', 
                    email: 'polkes021015@fktpdenkesyah.com',
                    image: defaultClinicImages[3],
                    income: [],
                    realization: {
                        honor: { medis: 27000000, paramedis: 13500000, pengelola: 8500000 },
                        operational: { atk: 23000000, obat: 51000000 },
                        modal: [
                            { id: 10, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 3, total: 1500000 },
                            { id: 11, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 7, total: 2100000 },
                            { id: 12, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 156000000,
                        totalSpent: 112000000,
                        remaining: 44000000,
                        byCategory: {
                            honor: { allocated: 46800000, spent: 41000000, remaining: 5800000 },
                            operational: { allocated: 78000000, spent: 74000000, remaining: 4000000 },
                            modal: { allocated: 31200000, spent: 27000000, remaining: 4200000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 5, 
                    name: 'Polkes 02.10.16 Liwa', 
                    address: 'Jl. Raya Liwa No. 56, Liwa', 
                    phone: '0728-5678901', 
                    email: 'polkes021016@fktpdenkesyah.com',
                    image: defaultClinicImages[4],
                    income: [],
                    realization: {
                        honor: { medis: 28500000, paramedis: 14200000, pengelola: 9300000 },
                        operational: { atk: 24000000, obat: 53500000 },
                        modal: [
                            { id: 13, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 5, total: 2500000 },
                            { id: 14, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 9, total: 2700000 },
                            { id: 15, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 161000000,
                        totalSpent: 116000000,
                        remaining: 45000000,
                        byCategory: {
                            honor: { allocated: 48300000, spent: 43000000, remaining: 5300000 },
                            operational: { allocated: 80500000, spent: 77000000, remaining: 3500000 },
                            modal: { allocated: 32200000, spent: 26000000, remaining: 6200000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 6, 
                    name: 'Polkes 02.10.17 Tanggamus', 
                    address: 'Jl. Raya Tanggamus No. 89, Tanggamus', 
                    phone: '0722-6789012', 
                    email: 'polkes021017@fktpdenkesyah.com',
                    image: defaultClinicImages[5],
                    income: [],
                    realization: {
                        honor: { medis: 27500000, paramedis: 13800000, pengelola: 8700000 },
                        operational: { atk: 23500000, obat: 52000000 },
                        modal: [
                            { id: 16, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 4, total: 2000000 },
                            { id: 17, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 8, total: 2400000 },
                            { id: 18, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 158000000,
                        totalSpent: 114000000,
                        remaining: 44000000,
                        byCategory: {
                            honor: { allocated: 47400000, spent: 42000000, remaining: 5400000 },
                            operational: { allocated: 79000000, spent: 75000000, remaining: 4000000 },
                            modal: { allocated: 31600000, spent: 27000000, remaining: 4600000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 7, 
                    name: 'Polkesdim 0426 Tulang Bawang', 
                    address: 'Jl. Raya Tulang Bawang No. 34, Tulang Bawang', 
                    phone: '0726-7890123', 
                    email: 'polkesdim0426@fktpdenkesyah.com',
                    image: defaultClinicImages[6],
                    income: [],
                    realization: {
                        honor: { medis: 29500000, paramedis: 14700000, pengelola: 9800000 },
                        operational: { atk: 25000000, obat: 55500000 },
                        modal: [
                            { id: 19, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 6, total: 3000000 },
                            { id: 20, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 11, total: 3300000 },
                            { id: 21, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 4, total: 3200000 }
                        ]
                    },
                    budget: {
                        totalBudget: 163000000,
                        totalSpent: 118000000,
                        remaining: 45000000,
                        byCategory: {
                            honor: { allocated: 48900000, spent: 44000000, remaining: 4900000 },
                            operational: { allocated: 81500000, spent: 80000000, remaining: 1500000 },
                            modal: { allocated: 32600000, spent: 28000000, remaining: 4600000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 8, 
                    name: 'Polkesdim 0427 Way Kanan', 
                    address: 'Jl. Raya Way Kanan No. 67, Way Kanan', 
                    phone: '0728-8901234', 
                    email: 'polkesdim0427@fktpdenkesyah.com',
                    image: defaultClinicImages[7],
                    income: [],
                    realization: {
                        honor: { medis: 27000000, paramedis: 13500000, pengelola: 8500000 },
                        operational: { atk: 23000000, obat: 51500000 },
                        modal: [
                            { id: 22, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 3, total: 1500000 },
                            { id: 23, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 7, total: 2100000 },
                            { id: 24, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 2, total: 1600000 }
                        ]
                    },
                    budget: {
                        totalBudget: 157000000,
                        totalSpent: 113000000,
                        remaining: 44000000,
                        byCategory: {
                            honor: { allocated: 47100000, spent: 41000000, remaining: 6100000 },
                            operational: { allocated: 78500000, spent: 74000000, remaining: 4500000 },
                            modal: { allocated: 31400000, spent: 28000000, remaining: 3400000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 9, 
                    name: 'Polkesdim 0429 Lamtim', 
                    address: 'Jl. Raya Lampung Timur No. 12, Lampung Timur', 
                    phone: '0725-9012345', 
                    email: 'polkesdim0429@fktpdenkesyah.com',
                    image: defaultClinicImages[8],
                    income: [],
                    realization: {
                        honor: { medis: 28000000, paramedis: 14000000, pengelola: 9000000 },
                        operational: { atk: 24000000, obat: 53000000 },
                        modal: [
                            { id: 25, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 5, total: 2500000 },
                            { id: 26, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 9, total: 2700000 },
                            { id: 27, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 160000000,
                        totalSpent: 115000000,
                        remaining: 45000000,
                        byCategory: {
                            honor: { allocated: 48000000, spent: 43000000, remaining: 5000000 },
                            operational: { allocated: 80000000, spent: 77000000, remaining: 3000000 },
                            modal: { allocated: 32000000, spent: 28000000, remaining: 4000000 }
                        },
                        monthlyRemaining: []
                    }
                },
                { 
                    id: 10, 
                    name: 'Klinik Tonkes Yonif 143/TWEJ', 
                    address: 'Jl. Raya Sukadana No. 45, Lampung Timur', 
                    phone: '0725-0123456', 
                    email: 'tonkesyonif143@fktpdenkesyah.com',
                    image: defaultClinicImages[9],
                    income: [],
                    realization: {
                        honor: { medis: 29000000, paramedis: 14500000, pengelola: 9500000 },
                        operational: { atk: 24500000, obat: 54000000 },
                        modal: [
                            { id: 28, nama: 'Stetoskop', satuan: 'Unit', harga: 500000, jumlah: 6, total: 3000000 },
                            { id: 29, nama: 'Termometer Digital', satuan: 'Unit', harga: 300000, jumlah: 10, total: 3000000 },
                            { id: 30, nama: 'Tensimeter', satuan: 'Unit', harga: 800000, jumlah: 3, total: 2400000 }
                        ]
                    },
                    budget: {
                        totalBudget: 162000000,
                        totalSpent: 117000000,
                        remaining: 45000000,
                        byCategory: {
                            honor: { allocated: 48600000, spent: 44000000, remaining: 4600000 },
                            operational: { allocated: 81000000, spent: 78000000, remaining: 3000000 },
                            modal: { allocated: 32400000, spent: 29000000, remaining: 3400000 }
                        },
                        monthlyRemaining: []
                    }
                }
            ];
            
            // Initialize income data for all clinics for 2 years back and 5 years forward
            function initializeIncomeData() {
                const years = generateYears();
                
                clinics.forEach(clinic => {
                    // Clear existing income data
                    clinic.income = [];
                    
                    // Generate sample data for each month of each year
                    years.forEach(year => {
                        for (let month = 1; month <= 12; month++) {
                            // Generate sample amount (between 140M and 170M)
                            const baseAmount = 140000000;
                            const randomVariance = Math.floor(Math.random() * 30000000);
                            const amount = baseAmount + randomVariance;
                            
                            clinic.income.push({
                                month: month,
                                year: year,
                                amount: amount
                            });
                        }
                    });
                });
            }
            
            // Initialize budget data for all clinics for 2 years back and 5 years forward
            function initializeBudgetData() {
                const years = generateYears();
                
                clinics.forEach(clinic => {
                    // Clear existing budget data
                    clinic.budget.monthlyRemaining = [];
                    
                    // Generate sample data for each month of each year
                    years.forEach(year => {
                        for (let month = 1; month <= 12; month++) {
                            // Generate sample budget data
                            const baseBudget = 150000000;
                            const randomVariance = Math.floor(Math.random() * 20000000);
                            const budget = baseBudget + randomVariance;
                            
                            const spentPercentage = 0.75 + (Math.random() * 0.1); // 75% - 85%
                            const spent = Math.floor(budget * spentPercentage);
                            const remaining = budget - spent;
                            
                            clinic.budget.monthlyRemaining.push({
                                month: month,
                                year: year,
                                budget: budget,
                                spent: spent,
                                remaining: remaining
                            });
                        }
                    });
                });
            }
            
            // Initialize data when page loads
            initializeIncomeData();
            initializeBudgetData();
            
            // State aplikasi
            let currentUser = null;
            let currentClinic = null;
            let currentDashboardFilters = {
                year: new Date().getFullYear(),
                month: 'all'
            };
            let currentIncomeFilters = {
                year: new Date().getFullYear(),
                month: 'all'
            };
            let currentRealizationFilters = {
                year: new Date().getFullYear(),
                month: 'all'
            };
            let currentBudgetFilters = {
                year: new Date().getFullYear(),
                month: 'all'
            };
            let currentRecapFilters = {
                year: new Date().getFullYear(),
                month: 'all'
            };
            
            // Chart instances
            let budgetChart = null;
            let recapChart = null;
            
            // Tunggu hingga halaman sepenuhnya dimuat
            document.addEventListener('DOMContentLoaded', function() {
                console.log('Halaman telah dimuat');
                
                // Populate year dropdowns
                populateYearDropdowns();
                
                // Cek apakah user sudah login sebelumnya
                checkSavedLogin();
                
                // Setup form login
                const loginForm = document.getElementById('login-form');
                if (loginForm) {
                    loginForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleLogin();
                    });
                }
                
                // Setup logout button
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        handleLogout();
                    });
                }
                
                // Setup navigation buttons
                setupNavigation();
                
                // Setup clinic detail navigation
                setupClinicDetailNavigation();
                
                // Setup edit form
                setupEditForm();
                
                // Setup finance forms
                setupFinanceForms();
                
                // Setup filters
                setupFilters();
                
                // Setup export buttons
                setupExportButtons();
                
                // Setup image upload
                setupImageUpload();
                
                // Setup monthly tabs
                setupMonthlyTabs();
                
                // Initialize charts
                initializeCharts();
            });
            
            // Populate year dropdowns
            function populateYearDropdowns() {
                const years = generateYears();
                
                // Dashboard year filter
                const dashboardYearFilter = document.getElementById('dashboard-year-filter');
                if (dashboardYearFilter) {
                    dashboardYearFilter.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        dashboardYearFilter.appendChild(option);
                    });
                    
                    // Set default to current year
                    dashboardYearFilter.value = new Date().getFullYear();
                }
                
                // Income year filter
                const incomeYearFilter = document.getElementById('income-year-filter');
                if (incomeYearFilter) {
                    incomeYearFilter.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        incomeYearFilter.appendChild(option);
                    });
                    
                    // Set default to current year
                    incomeYearFilter.value = new Date().getFullYear();
                }
                
                // Income year in form
                const incomeYearForm = document.getElementById('income-year');
                if (incomeYearForm) {
                    incomeYearForm.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        incomeYearForm.appendChild(option);
                    });
                    
                    // Set default to current year
                    incomeYearForm.value = new Date().getFullYear();
                }
                
                // Realization year filter
                const realizationYearFilter = document.getElementById('realization-year-filter');
                if (realizationYearFilter) {
                    realizationYearFilter.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        realizationYearFilter.appendChild(option);
                    });
                    
                    // Set default to current year
                    realizationYearFilter.value = new Date().getFullYear();
                }
                
                // Budget year filter
                const budgetYearFilter = document.getElementById('budget-year-filter');
                if (budgetYearFilter) {
                    budgetYearFilter.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        budgetYearFilter.appendChild(option);
                    });
                    
                    // Set default to current year
                    budgetYearFilter.value = new Date().getFullYear();
                }
                
                // Budget year in form
                const budgetYearForm = document.getElementById('budget-year');
                if (budgetYearForm) {
                    budgetYearForm.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        budgetYearForm.appendChild(option);
                    });
                    
                    // Set default to current year
                    budgetYearForm.value = new Date().getFullYear();
                }
                
                // Recap year filter
                const recapYearFilter = document.getElementById('recap-year-filter');
                if (recapYearFilter) {
                    recapYearFilter.innerHTML = '';
                    years.forEach(year => {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        recapYearFilter.appendChild(option);
                    });
                    
                    // Set default to current year
                    recapYearFilter.value = new Date().getFullYear();
                }
            }
            
            // Fungsi login
            function handleLogin() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Validasi login
                if ((username === 'minkes' && password === 'minkes123') || 
                    (username === 'klinik' && password === 'klinik123') || 
                    (username === 'user' && password === 'user123')) {
                    
                    // Simpan user ke localStorage
                    try {
                        localStorage.setItem('fktpUser', JSON.stringify({
                            username: username,
                            type: username === 'minkes' ? 'minkes' : 'klinik',
                            isLoggedIn: true
                        }));
                    } catch (e) {
                        console.log('Gagal menyimpan ke localStorage:', e);
                    }
                    
                    // Set current user
                    currentUser = {
                        username: username,
                        type: username === 'minkes' ? 'minkes' : 'klinik'
                    };
                    
                    // Tampilkan dashboard
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('dashboard-section').style.display = 'block';
                    document.getElementById('user-display').textContent = `Halo, ${username}`;
                    document.getElementById('user-type-display').textContent = username === 'minkes' ? 'minkes' : 'klinik';
                    
                    // Load data klinik
                    loadClinics();
                    
                    // Tampilkan dashboard content
                    showDashboard();
                } else {
                    document.getElementById('error-message').style.display = 'block';
                }
            }
            
            // Fungsi logout
            function handleLogout() {
                try {
                    localStorage.removeItem('fktpUser');
                } catch (e) {
                    console.log('Gagal menghapus dari localStorage:', e);
                }
                
                currentUser = null;
                currentClinic = null;
                
                document.getElementById('login-section').style.display = 'block';
                document.getElementById('dashboard-section').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('error-message').style.display = 'none';
            }
            
            // Cek login yang tersimpan
            function checkSavedLogin() {
                try {
                    const savedUser = localStorage.getItem('fktpUser');
                    if (savedUser) {
                        const userData = JSON.parse(savedUser);
                        if (userData.isLoggedIn) {
                            currentUser = {
                                username: userData.username,
                                type: userData.type
                            };
                            
                            document.getElementById('login-section').style.display = 'none';
                            document.getElementById('dashboard-section').style.display = 'block';
                            document.getElementById('user-display').textContent = `Halo, ${userData.username}`;
                            document.getElementById('user-type-display').textContent = userData.type;
                            
                            loadClinics();
                            showDashboard();
                        }
                    }
                } catch (e) {
                    console.log('Error saat mengecek login yang tersimpan:', e);
                }
            }
            
            // Setup navigation
            function setupNavigation() {
                // Dashboard button
                const dashboardBtn = document.getElementById('btn-dashboard');
                if (dashboardBtn) {
                    dashboardBtn.addEventListener('click', function() {
                        showDashboard();
                    });
                }
                
                // Clinics button
                const clinicsBtn = document.getElementById('btn-clinics');
                if (clinicsBtn) {
                    clinicsBtn.addEventListener('click', function() {
                        showClinics();
                    });
                }
                
                // Recap button
                const recapBtn = document.getElementById('btn-recap');
                if (recapBtn) {
                    recapBtn.addEventListener('click', function() {
                        showRecap();
                    });
                }
                
                // Back to clinics button
                const backToClinicsBtn = document.getElementById('back-to-clinics');
                if (backToClinicsBtn) {
                    backToClinicsBtn.addEventListener('click', function() {
                        showClinics();
                    });
                }
            }
            
            // Setup clinic detail navigation
            function setupClinicDetailNavigation() {
                // Clinic info button
                const clinicInfoBtn = document.getElementById('btn-clinic-info');
                if (clinicInfoBtn) {
                    clinicInfoBtn.addEventListener('click', function() {
                        showClinicInfo();
                    });
                }
                
                // Clinic income button
                const clinicIncomeBtn = document.getElementById('btn-clinic-income');
                if (clinicIncomeBtn) {
                    clinicIncomeBtn.addEventListener('click', function() {
                        showClinicIncome();
                    });
                }
                
                // Clinic realization button
                const clinicRealizationBtn = document.getElementById('btn-clinic-realization');
                if (clinicRealizationBtn) {
                    clinicRealizationBtn.addEventListener('click', function() {
                        showClinicRealization();
                    });
                }
                
                // Clinic budget button
                const clinicBudgetBtn = document.getElementById('btn-clinic-budget');
                if (clinicBudgetBtn) {
                    clinicBudgetBtn.addEventListener('click', function() {
                        showClinicBudget();
                    });
                }
                
                // Clinic finance button
                const clinicFinanceBtn = document.getElementById('btn-clinic-finance');
                if (clinicFinanceBtn) {
                    clinicFinanceBtn.addEventListener('click', function() {
                        showClinicFinance();
                    });
                }
                
                // Clinic edit button
                const clinicEditBtn = document.getElementById('btn-clinic-edit');
                if (clinicEditBtn) {
                    clinicEditBtn.addEventListener('click', function() {
                        showClinicEdit();
                    });
                }
                
                // Cancel edit button
                const cancelEditBtn = document.getElementById('cancel-edit');
                if (cancelEditBtn) {
                    cancelEditBtn.addEventListener('click', function() {
                        showClinicInfo();
                    });
                }
            }
            
            // Setup edit form
            function setupEditForm() {
                const editForm = document.getElementById('edit-clinic-form');
                if (editForm) {
                    editForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveClinicEdit();
                    });
                }
            }
            
            // Setup finance forms
            function setupFinanceForms() {
                // Add income button
                const addIncomeBtn = document.getElementById('add-income-btn');
                if (addIncomeBtn) {
                    addIncomeBtn.addEventListener('click', function() {
                        document.getElementById('income-form-container').style.display = 'block';
                        this.style.display = 'none';
                    });
                }
                
                // Cancel income button
                const cancelIncomeBtn = document.getElementById('cancel-income-btn');
                if (cancelIncomeBtn) {
                    cancelIncomeBtn.addEventListener('click', function() {
                        document.getElementById('income-form-container').style.display = 'none';
                        document.getElementById('add-income-btn').style.display = 'block';
                    });
                }
                
                // Save income button
                const saveIncomeBtn = document.getElementById('save-income-btn');
                if (saveIncomeBtn) {
                    saveIncomeBtn.addEventListener('click', function() {
                        saveIncomeData();
                    });
                }
                
                // Save honor button
                const saveHonorBtn = document.getElementById('save-honor-btn');
                if (saveHonorBtn) {
                    saveHonorBtn.addEventListener('click', function() {
                        saveHonorData();
                    });
                }
                
                // Save operational button
                const saveOperationalBtn = document.getElementById('save-operational-btn');
                if (saveOperationalBtn) {
                    saveOperationalBtn.addEventListener('click', function() {
                        saveOperationalData();
                    });
                }
                
                // Add modal item button
                const addModalItemBtn = document.getElementById('add-modal-item-btn');
                if (addModalItemBtn) {
                    addModalItemBtn.addEventListener('click', function() {
                        document.getElementById('modal-form-container').style.display = 'block';
                    });
                }
                
                // Cancel modal button
                const cancelModalBtn = document.getElementById('cancel-modal-btn');
                if (cancelModalBtn) {
                    cancelModalBtn.addEventListener('click', function() {
                        document.getElementById('modal-form-container').style.display = 'none';
                    });
                }
                
                // Save modal button
                const saveModalBtn = document.getElementById('save-modal-btn');
                if (saveModalBtn) {
                    saveModalBtn.addEventListener('click', function() {
                        saveModalData();
                    });
                }
                
                // Add budget button
                const addBudgetBtn = document.getElementById('add-budget-btn');
                if (addBudgetBtn) {
                    addBudgetBtn.addEventListener('click', function() {
                        document.getElementById('budget-form-container').style.display = 'block';
                        this.style.display = 'none';
                    });
                }
                
                // Cancel budget button
                const cancelBudgetBtn = document.getElementById('cancel-budget-btn');
                if (cancelBudgetBtn) {
                    cancelBudgetBtn.addEventListener('click', function() {
                        document.getElementById('budget-form-container').style.display = 'none';
                        document.getElementById('add-budget-btn').style.display = 'block';
                    });
                }
                
                // Save budget button
                const saveBudgetBtn = document.getElementById('save-budget-btn');
                if (saveBudgetBtn) {
                    saveBudgetBtn.addEventListener('click', function() {
                        saveBudgetData();
                    });
                }
                
                // Save total budget button
                const saveTotalBudgetBtn = document.getElementById('save-total-budget-btn');
                if (saveTotalBudgetBtn) {
                    saveTotalBudgetBtn.addEventListener('click', function() {
                        saveTotalBudgetData();
                    });
                }
                
                // Save allocated budget button
                const saveAllocatedBudgetBtn = document.getElementById('save-allocated-budget-btn');
                if (saveAllocatedBudgetBtn) {
                    saveAllocatedBudgetBtn.addEventListener('click', function() {
                        saveAllocatedBudgetData();
                    });
                }
                
                // Save spent budget button
                const saveSpentBudgetBtn = document.getElementById('save-spent-budget-btn');
                if (saveSpentBudgetBtn) {
                    saveSpentBudgetBtn.addEventListener('click', function() {
                        saveSpentBudgetData();
                    });
                }
            }
            
            // Setup filters
            function setupFilters() {
                // Dashboard filters
                const dashboardYearFilter = document.getElementById('dashboard-year-filter');
                if (dashboardYearFilter) {
                    dashboardYearFilter.addEventListener('change', function() {
                        currentDashboardFilters.year = parseInt(this.value);
                        updateDashboardCharts();
                        loadDashboardBudgetTable();
                    });
                }
                
                const dashboardMonthFilter = document.getElementById('dashboard-month-filter');
                if (dashboardMonthFilter) {
                    dashboardMonthFilter.addEventListener('change', function() {
                        currentDashboardFilters.month = this.value;
                        updateDashboardCharts();
                        loadDashboardBudgetTable();
                    });
                }
                
                // Income filters
                const incomeYearFilter = document.getElementById('income-year-filter');
                if (incomeYearFilter) {
                    incomeYearFilter.addEventListener('change', function() {
                        currentIncomeFilters.year = parseInt(this.value);
                        if (currentClinic) {
                            loadClinicIncome(currentClinic);
                        }
                    });
                }
                
                const incomeMonthFilter = document.getElementById('income-month-filter');
                if (incomeMonthFilter) {
                    incomeMonthFilter.addEventListener('change', function() {
                        currentIncomeFilters.month = this.value;
                        if (currentClinic) {
                            loadClinicIncome(currentClinic);
                        }
                    });
                }
                
                // Realization filters
                const realizationYearFilter = document.getElementById('realization-year-filter');
                if (realizationYearFilter) {
                    realizationYearFilter.addEventListener('change', function() {
                        currentRealizationFilters.year = parseInt(this.value);
                        if (currentClinic) {
                            loadClinicRealization(currentClinic);
                        }
                    });
                }
                
                const realizationMonthFilter = document.getElementById('realization-month-filter');
                if (realizationMonthFilter) {
                    realizationMonthFilter.addEventListener('change', function() {
                        currentRealizationFilters.month = this.value;
                        if (currentClinic) {
                            loadClinicRealization(currentClinic);
                        }
                    });
                }
                
                // Budget filters
                const budgetYearFilter = document.getElementById('budget-year-filter');
                if (budgetYearFilter) {
                    budgetYearFilter.addEventListener('change', function() {
                        currentBudgetFilters.year = parseInt(this.value);
                        if (currentClinic) {
                            loadClinicBudget(currentClinic);
                        }
                    });
                }
                
                const budgetMonthFilter = document.getElementById('budget-month-filter');
                if (budgetMonthFilter) {
                    budgetMonthFilter.addEventListener('change', function() {
                        currentBudgetFilters.month = this.value;
                        if (currentClinic) {
                            loadClinicBudget(currentClinic);
                        }
                    });
                }
                
                // Recap filters
                const recapYearFilter = document.getElementById('recap-year-filter');
                if (recapYearFilter) {
                    recapYearFilter.addEventListener('change', function() {
                        currentRecapFilters.year = parseInt(this.value);
                        updateRecapChart();
                        loadRecapData();
                    });
                }
                
                const recapMonthFilter = document.getElementById('recap-month-filter');
                if (recapMonthFilter) {
                    recapMonthFilter.addEventListener('change', function() {
                        currentRecapFilters.month = this.value;
                        updateRecapChart();
                        loadRecapData();
                    });
                }
            }
            
            // Setup export buttons
            function setupExportButtons() {
                // Excel download link
                const downloadExcelLink = document.getElementById('download-excel');
                if (downloadExcelLink) {
                    downloadExcelLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        downloadExcelReport();
                    });
                }
                
                // PowerPoint download link
                const downloadPowerPointLink = document.getElementById('download-powerpoint');
                if (downloadPowerPointLink) {
                    downloadPowerPointLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        downloadPowerPointReport();
                    });
                }
            }
            
            // Setup image upload
            function setupImageUpload() {
                const imageUploadArea = document.getElementById('image-upload-area');
                const imageInput = document.getElementById('edit-clinic-image');
                const imagePreview = document.getElementById('edit-clinic-image-preview');
                
                if (imageUploadArea && imageInput) {
                    // Click to upload
                    imageUploadArea.addEventListener('click', function() {
                        imageInput.click();
                    });
                    
                    // Drag and drop
                    imageUploadArea.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        this.style.borderColor = '#2563eb';
                        this.style.backgroundColor = '#f0f7ff';
                    });
                    
                    imageUploadArea.addEventListener('dragleave', function(e) {
                        e.preventDefault();
                        this.style.borderColor = '#d1d5db';
                        this.style.backgroundColor = '#f8fafc';
                    });
                    
                    imageUploadArea.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.style.borderColor = '#d1d5db';
                        this.style.backgroundColor = '#f8fafc';
                        
                        if (e.dataTransfer.files.length > 0) {
                            imageInput.files = e.dataTransfer.files;
                            handleImageUpload();
                        }
                    });
                    
                    // File selection
                    imageInput.addEventListener('change', function() {
                        handleImageUpload();
                    });
                }
            }
            
            // Handle image upload
            function handleImageUpload() {
                const imageInput = document.getElementById('edit-clinic-image');
                const imagePreview = document.getElementById('edit-clinic-image-preview');
                
                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(imageInput.files[0]);
                }
            }
            
            // Setup monthly tabs
            function setupMonthlyTabs() {
                // Income tabs
                const incomeTabs = document.querySelectorAll('#clinic-income-section .monthly-tab');
                incomeTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Remove active class from all tabs
                        incomeTabs.forEach(t => t.classList.remove('active'));
                        // Add active class to clicked tab
                        this.classList.add('active');
                        
                        // Hide all content
                        document.querySelectorAll('#clinic-income-section .monthly-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        // Show selected content
                        const tabId = this.getAttribute('data-tab');
                        document.getElementById(`income-${tabId}-content`).classList.add('active');
                        
                        // Reload data if needed
                        if (currentClinic) {
                            if (tabId === 'monthly') {
                                loadClinicIncome(currentClinic);
                            } else {
                                loadIncomeYearlyData(currentClinic);
                            }
                        }
                    });
                });
                
                // Realization tabs
                const realizationTabs = document.querySelectorAll('#clinic-realization-section .monthly-tab');
                realizationTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Remove active class from all tabs
                        realizationTabs.forEach(t => t.classList.remove('active'));
                        // Add active class to clicked tab
                        this.classList.add('active');
                        
                        // Hide all content
                        document.querySelectorAll('#clinic-realization-section .monthly-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        // Show selected content
                        const tabId = this.getAttribute('data-tab');
                        document.getElementById(`realization-${tabId}-content`).classList.add('active');
                        
                        // Reload data if needed
                        if (currentClinic) {
                            if (tabId === 'monthly') {
                                loadClinicRealization(currentClinic);
                            } else {
                                loadRealizationYearlyData(currentClinic);
                            }
                        }
                    });
                });
                
                // Budget tabs
                const budgetTabs = document.querySelectorAll('#clinic-budget-section .monthly-tab');
                budgetTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Remove active class from all tabs
                        budgetTabs.forEach(t => t.classList.remove('active'));
                        // Add active class to clicked tab
                        this.classList.add('active');
                        
                        // Hide all content
                        document.querySelectorAll('#clinic-budget-section .monthly-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        // Show selected content
                        const tabId = this.getAttribute('data-tab');
                        document.getElementById(`budget-${tabId}-content`).classList.add('active');
                        
                        // Reload data if needed
                        if (currentClinic) {
                            if (tabId === 'monthly') {
                                loadClinicBudget(currentClinic);
                            } else {
                                loadBudgetYearlyData(currentClinic);
                            }
                        }
                    });
                });
            }
            
            // Initialize charts
            function initializeCharts() {
                // Initialize budget chart
                const budgetChartCtx = document.getElementById('budget-chart');
                if (budgetChartCtx) {
                    budgetChart = new Chart(budgetChartCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
                            datasets: [
                                {
                                    label: 'Total Anggaran',
                                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                    backgroundColor: '#3b82f6',
                                    borderColor: '#2563eb',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Total Realisasi',
                                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                    backgroundColor: '#10b981',
                                    borderColor: '#059669',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'Rp ' + value.toLocaleString('id-ID');
                                        }
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': Rp ' + context.raw.toLocaleString('id-ID');
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Initialize recap chart
                const recapChartCtx = document.getElementById('recap-chart');
                if (recapChartCtx) {
                    recapChart = new Chart(recapChartCtx, {
                        type: 'pie',
                        data: {
                            labels: [],
                            datasets: [{
                                data: [],
                                backgroundColor: [
                                    '#3b82f6', '#10b981', '#f59e0b', '#ef4444', 
                                    '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16',
                                    '#f97316', '#6b7280'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.raw || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `${label}: Rp ${value.toLocaleString('id-ID')} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            // Update dashboard charts
            function updateDashboardCharts() {
                if (!budgetChart) return;
                
                const year = currentDashboardFilters.year;
                const monthFilter = currentDashboardFilters.month;
                
                // Calculate monthly data
                const monthlyData = {
                    budget: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    realization: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                };
                
                // Aggregate data from all clinics
                clinics.forEach(clinic => {
                    clinic.budget.monthlyRemaining.forEach(item => {
                        if (item.year === year) {
                            const monthIndex = item.month - 1;
                            if (monthFilter === 'all' || monthFilter == item.month) {
                                monthlyData.budget[monthIndex] += item.budget;
                                monthlyData.realization[monthIndex] += item.spent;
                            }
                        }
                    });
                });
                
                // Update chart
                budgetChart.data.datasets[0].data = monthlyData.budget;
                budgetChart.data.datasets[1].data = monthlyData.realization;
                budgetChart.update();
                
                // Update summary stats
                const totalBudget = monthlyData.budget.reduce((sum, val) => sum + val, 0);
                const totalRealization = monthlyData.realization.reduce((sum, val) => sum + val, 0);
                const totalRemaining = totalBudget - totalRealization;
                
                document.getElementById('total-income').textContent = `Rp ${totalBudget.toLocaleString('id-ID')}`;
                document.getElementById('total-realization').textContent = `Rp ${totalRealization.toLocaleString('id-ID')}`;
                document.getElementById('total-remaining').textContent = `Rp ${totalRemaining.toLocaleString('id-ID')}`;
            }
            
            // Load dashboard budget table
            function loadDashboardBudgetTable() {
                const tbody = document.getElementById('dashboard-budget-table');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                const year = currentDashboardFilters.year;
                const monthFilter = currentDashboardFilters.month;
                
                // Calculate monthly data
                const monthlyData = [];
                
                for (let month = 1; month <= 12; month++) {
                    if (monthFilter === 'all' || monthFilter == month) {
                        let totalBudget = 0;
                        let totalRealization = 0;
                        
                        clinics.forEach(clinic => {
                            const budgetData = clinic.budget.monthlyRemaining.find(item => 
                                item.year === year && item.month === month
                            );
                            
                            if (budgetData) {
                                totalBudget += budgetData.budget;
                                totalRealization += budgetData.spent;
                            }
                        });
                        
                        const remaining = totalBudget - totalRealization;
                        const percentage = totalBudget > 0 ? Math.round((totalRealization / totalBudget) * 100) : 0;
                        
                        monthlyData.push({
                            month: month,
                            budget: totalBudget,
                            realization: totalRealization,
                            remaining: remaining,
                            percentage: percentage
                        });
                    }
                }
                
                // Sort by month
                monthlyData.sort((a, b) => a.month - b.month);
                
                // Create table rows
                monthlyData.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${getMonthName(item.month)}</td>
                        <td>Rp ${item.budget.toLocaleString('id-ID')}</td>
                        <td>Rp ${item.realization.toLocaleString('id-ID')}</td>
                        <td>Rp ${item.remaining.toLocaleString('id-ID')}</td>
                        <td>${item.percentage}%</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Update recap chart
            function updateRecapChart() {
                if (!recapChart) return;
                
                const year = currentRecapFilters.year;
                const monthFilter = currentRecapFilters.month;
                
                // Calculate data for each clinic
                const clinicNames = [];
                const clinicTotals = [];
                
                clinics.forEach(clinic => {
                    let totalRealization = 0;
                    
                    if (monthFilter === 'all') {
                        // Sum all months for the year
                        clinic.budget.monthlyRemaining.forEach(item => {
                            if (item.year === year) {
                                totalRealization += item.spent;
                            }
                        });
                    } else {
                        // Get specific month
                        const budgetData = clinic.budget.monthlyRemaining.find(item => 
                            item.year === year && item.month == monthFilter
                        );
                        
                        if (budgetData) {
                            totalRealization = budgetData.spent;
                        }
                    }
                    
                    clinicNames.push(clinic.name);
                    clinicTotals.push(totalRealization);
                });
                
                // Update chart
                recapChart.data.labels = clinicNames;
                recapChart.data.datasets[0].data = clinicTotals;
                recapChart.update();
            }
            
            // Download Excel report
            function downloadExcelReport() {
                const year = currentRecapFilters.year;
                const monthFilter = currentRecapFilters.month;
                
                let csvContent = "text/csv;charset=utf-8,";
                csvContent += "LAPORAN REKAPITULASI ANGGARAN FKTP DENKESYAH 02.04.03\n\n";
                csvContent += `Tahun: ${year}\n`;
                csvContent += `Bulan: ${monthFilter === 'all' ? 'Semua Bulan' : getMonthName(parseInt(monthFilter))}\n\n`;
                
                // Headers
                csvContent += "No,Nama Klinik,Total Anggaran,Total Realisasi,Sisa Anggaran,Persentase Realisasi\n";
                
                // Data
                clinics.forEach((clinic, index) => {
                    let totalBudget = 0;
                    let totalRealization = 0;
                    
                    if (monthFilter === 'all') {
                        clinic.budget.monthlyRemaining.forEach(item => {
                            if (item.year === year) {
                                totalBudget += item.budget;
                                totalRealization += item.spent;
                            }
                        });
                    } else {
                        const budgetData = clinic.budget.monthlyRemaining.find(item => 
                            item.year === year && item.month == monthFilter
                        );
                        
                        if (budgetData) {
                            totalBudget = budgetData.budget;
                            totalRealization = budgetData.spent;
                        }
                    }
                    
                    const remaining = totalBudget - totalRealization;
                    const percentage = totalBudget > 0 ? Math.round((totalRealization / totalBudget) * 100) : 0;
                    
                    csvContent += `${index + 1},${clinic.name},${totalBudget},${totalRealization},${remaining},${percentage}%\n`;
                });
                
                // Create download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `Rekap_Anggaran_FKTP_${year}_${monthFilter === 'all' ? 'SemuaBulan' : getMonthName(parseInt(monthFilter))}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('Laporan Excel berhasil diunduh!');
            }
            
            // Download PowerPoint report (simulated)
            function downloadPowerPointReport() {
                alert('Fitur export ke PowerPoint akan tersedia di versi berikutnya.\n\nUntuk saat ini, Anda dapat menggunakan laporan Excel yang telah diunduh.');
            }
            
            // Load daftar klinik
            function loadClinics() {
                const container = document.getElementById('clinics-container');
                if (!container) return;
                
                container.innerHTML = '';
                
                clinics.forEach(clinic => {
                    const clinicCard = document.createElement('div');
                    clinicCard.className = 'clinic-card';
                    clinicCard.innerHTML = `
                        <div class="clinic-name">${clinic.name}</div>
                        <div class="clinic-detail">Alamat: ${clinic.address}</div>
                        <div class="clinic-detail">Telepon: ${clinic.phone}</div>
                        <div class="clinic-detail">Email: ${clinic.email}</div>
                        <div class="clinic-actions">
                            <button class="btn-success view-clinic-btn" data-id="${clinic.id}">Lihat Detail</button>
                            ${currentUser && currentUser.type === 'minkes' ? `<button class="btn-warning edit-clinic-btn" data-id="${clinic.id}">Edit</button>` : ''}
                        </div>
                    `;
                    container.appendChild(clinicCard);
                });
                
                // Setup event listeners untuk tombol view dan edit
                document.querySelectorAll('.view-clinic-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const clinicId = parseInt(this.getAttribute('data-id'));
                        viewClinic(clinicId);
                    });
                });
                
                if (currentUser && currentUser.type === 'minkes') {
                    document.querySelectorAll('.edit-clinic-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const clinicId = parseInt(this.getAttribute('data-id'));
                            editClinic(clinicId);
                        });
                    });
                }
                
                // Update total clinics display
                document.getElementById('total-clinics').textContent = clinics.length;
                
                // Initialize dashboard charts
                updateDashboardCharts();
                loadDashboardBudgetTable();
            }
            
            // Tampilkan dashboard
            function showDashboard() {
                hideAllContent();
                document.getElementById('dashboard-content').style.display = 'block';
                
                // Update active button
                setActiveButton('btn-dashboard');
                
                // Update charts and tables
                updateDashboardCharts();
                loadDashboardBudgetTable();
            }
            
            // Tampilkan daftar klinik
            function showClinics() {
                hideAllContent();
                document.getElementById('clinics-content').style.display = 'block';
                
                // Update active button
                setActiveButton('btn-clinics');
            }
            
            // Tampilkan rekap total
            function showRecap() {
                hideAllContent();
                document.getElementById('recap-content').style.display = 'block';
                
                // Update charts
                updateRecapChart();
                loadRecapData();
                
                // Update active button
                setActiveButton('btn-recap');
            }
            
            // Sembunyikan semua konten
            function hideAllContent() {
                document.getElementById('dashboard-content').style.display = 'none';
                document.getElementById('clinics-content').style.display = 'none';
                document.getElementById('clinic-detail-content').style.display = 'none';
                document.getElementById('recap-content').style.display = 'none';
            }
            
            // Set active button
            function setActiveButton(buttonId) {
                document.querySelectorAll('.nav-buttons button').forEach(btn => {
                    btn.style.backgroundColor = '#4f46e5';
                });
                
                const activeBtn = document.getElementById(buttonId);
                if (activeBtn) {
                    activeBtn.style.backgroundColor = '#2563eb';
                }
            }
            
            // Lihat detail klinik
            function viewClinic(clinicId) {
                const clinic = clinics.find(c => c.id === clinicId);
                if (!clinic) return;
                
                currentClinic = clinic;
                
                // Update title
                document.getElementById('clinic-detail-title').textContent = `Detail Klinik: ${clinic.name}`;
                
                // Update info klinik
                document.getElementById('clinic-name').textContent = clinic.name;
                document.getElementById('clinic-address').textContent = clinic.address;
                document.getElementById('clinic-phone').textContent = clinic.phone;
                document.getElementById('clinic-email').textContent = clinic.email;
                
                // Update gambar klinik
                const clinicImage = document.getElementById('clinic-image');
                if (clinicImage) {
                    clinicImage.src = clinic.image;
                }
                
                // Tampilkan tombol edit hanya untuk minkes
                const editBtn = document.getElementById('btn-clinic-edit');
                if (editBtn) {
                    if (currentUser && currentUser.type === 'minkes') {
                        editBtn.style.display = 'block';
                        document.getElementById('add-income-btn').style.display = 'block';
                        document.getElementById('add-budget-btn').style.display = 'block';
                    } else {
                        editBtn.style.display = 'none';
                        document.getElementById('add-income-btn').style.display = 'none';
                        document.getElementById('add-budget-btn').style.display = 'none';
                    }
                }
                
                // Load data laporan
                loadClinicIncome(clinic);
                loadClinicRealization(clinic);
                loadClinicBudget(clinic);
                
                // Tampilkan clinic detail content
                hideAllContent();
                document.getElementById('clinic-detail-content').style.display = 'block';
                
                // Tampilkan info section by default
                showClinicInfo();
            }
            
            // Edit klinik
            function editClinic(clinicId) {
                const clinic = clinics.find(c => c.id === clinicId);
                if (!clinic) return;
                
                currentClinic = clinic;
                
                // Isi form dengan data klinik
                document.getElementById('edit-clinic-id').value = clinic.id;
                document.getElementById('edit-clinic-name').value = clinic.name;
                document.getElementById('edit-clinic-address').value = clinic.address;
                document.getElementById('edit-clinic-phone').value = clinic.phone;
                document.getElementById('edit-clinic-email').value = clinic.email;
                
                // Tampilkan preview gambar
                const imagePreview = document.getElementById('edit-clinic-image-preview');
                if (imagePreview) {
                    imagePreview.src = clinic.image;
                    imagePreview.style.display = 'block';
                }
                
                // Tampilkan edit section
                showClinicEdit();
            }
            
            // Simpan edit klinik
            function saveClinicEdit() {
                if (!currentClinic) return;
                
                const clinicId = parseInt(document.getElementById('edit-clinic-id').value);
                const clinicIndex = clinics.findIndex(c => c.id === clinicId);
                
                if (clinicIndex === -1) return;
                
                // Update data klinik
                clinics[clinicIndex].name = document.getElementById('edit-clinic-name').value;
                clinics[clinicIndex].address = document.getElementById('edit-clinic-address').value;
                clinics[clinicIndex].phone = document.getElementById('edit-clinic-phone').value;
                clinics[clinicIndex].email = document.getElementById('edit-clinic-email').value;
                
                // Update gambar jika ada file baru yang diupload
                const imageInput = document.getElementById('edit-clinic-image');
                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        clinics[clinicIndex].image = e.target.result;
                        // Update currentClinic
                        currentClinic.image = e.target.result;
                        
                        // Refresh daftar klinik jika sedang di halaman klinik
                        if (document.getElementById('clinics-content').style.display === 'block') {
                            loadClinics();
                        }
                        
                        // Update gambar di detail klinik
                        const clinicImage = document.getElementById('clinic-image');
                        if (clinicImage) {
                            clinicImage.src = e.target.result;
                        }
                        
                        // Tampilkan pesan sukses
                        alert('Data klinik berhasil diperbarui!');
                        
                        // Kembali ke info klinik
                        showClinicInfo();
                    };
                    reader.readAsDataURL(imageInput.files[0]);
                } else {
                    // Jika tidak ada gambar baru, langsung update
                    // Update currentClinic
                    currentClinic.name = clinics[clinicIndex].name;
                    currentClinic.address = clinics[clinicIndex].address;
                    currentClinic.phone = clinics[clinicIndex].phone;
                    currentClinic.email = clinics[clinicIndex].email;
                    
                    // Tampilkan pesan sukses
                    alert('Data klinik berhasil diperbarui!');
                    
                    // Kembali ke info klinik
                    showClinicInfo();
                    
                    // Refresh daftar klinik jika sedang di halaman klinik
                    if (document.getElementById('clinics-content').style.display === 'block') {
                        loadClinics();
                    }
                }
            }
            
            // Tampilkan info klinik
            function showClinicInfo() {
                document.getElementById('clinic-info-section').style.display = 'block';
                document.getElementById('clinic-income-section').style.display = 'none';
                document.getElementById('clinic-realization-section').style.display = 'none';
                document.getElementById('clinic-budget-section').style.display = 'none';
                document.getElementById('clinic-finance-section').style.display = 'none';
                document.getElementById('clinic-edit-section').style.display = 'none';
                
                // Update active button
                setActiveClinicButton('btn-clinic-info');
            }
            
            // Tampilkan laporan pendapatan
            function showClinicIncome() {
                document.getElementById('clinic-info-section').style.display = 'none';
                document.getElementById('clinic-income-section').style.display = 'block';
                document.getElementById('clinic-realization-section').style.display = 'none';
                document.getElementById('clinic-budget-section').style.display = 'none';
                document.getElementById('clinic-finance-section').style.display = 'none';
                document.getElementById('clinic-edit-section').style.display = 'none';
                
                // Update active button
                setActiveClinicButton('btn-clinic-income');
                
                // Load data
                if (currentClinic) {
                    loadClinicIncome(currentClinic);
                }
            }
            
            // Tampilkan realisasi pendapatan
            function showClinicRealization() {
                document.getElementById('clinic-info-section').style.display = 'none';
                document.getElementById('clinic-income-section').style.display = 'none';
                document.getElementById('clinic-realization-section').style.display = 'block';
                document.getElementById('clinic-budget-section').style.display = 'none';
                document.getElementById('clinic-finance-section').style.display = 'none';
                document.getElementById('clinic-edit-section').style.display = 'none';
                
                // Update active button
                setActiveClinicButton('btn-clinic-realization');
                
                // Load data
                if (currentClinic) {
                    loadClinicRealization(currentClinic);
                }
            }
            
            // Tampilkan sisa anggaran
            function showClinicBudget() {
                document.getElementById('clinic-info-section').style.display = 'none';
                document.getElementById('clinic-income-section').style.display = 'none';
                document.getElementById('clinic-realization-section').style.display = 'none';
                document.getElementById('clinic-budget-section').style.display = 'block';
                document.getElementById('clinic-finance-section').style.display = 'none';
                document.getElementById('clinic-edit-section').style.display = 'none';
                
                // Update active button
                setActiveClinicButton('btn-clinic-budget');
                
                // Load data
                if (currentClinic) {
                    loadClinicBudget(currentClinic);
                }
            }
            
            // Tampilkan form keuangan
            function showClinicFinance() {
                if (currentUser && currentUser.type === 'minkes') {
                    document.getElementById('clinic-info-section').style.display = 'none';
                    document.getElementById('clinic-income-section').style.display = 'none';
                    document.getElementById('clinic-realization-section').style.display = 'none';
                    document.getElementById('clinic-budget-section').style.display = 'none';
                    document.getElementById('clinic-finance-section').style.display = 'block';
                    document.getElementById('clinic-edit-section').style.display = 'none';
                    
                    // Isi form dengan data saat ini
                    if (currentClinic && currentClinic.budget) {
                        document.getElementById('total-budget-input').value = currentClinic.budget.totalBudget;
                        document.getElementById('honor-allocated-input').value = currentClinic.budget.byCategory.honor.allocated;
                        document.getElementById('operational-allocated-input').value = currentClinic.budget.byCategory.operational.allocated;
                        document.getElementById('modal-allocated-input').value = currentClinic.budget.byCategory.modal.allocated;
                        document.getElementById('honor-spent-input').value = currentClinic.budget.byCategory.honor.spent;
                        document.getElementById('operational-spent-input').value = currentClinic.budget.byCategory.operational.spent;
                        document.getElementById('modal-spent-input').value = currentClinic.budget.byCategory.modal.spent;
                    }
                    
                    // Update active button
                    setActiveClinicButton('btn-clinic-finance');
                } else {
                    alert('Hanya user dengan role "minkes" yang dapat mengakses fitur ini.');
                    showClinicInfo();
                }
            }
            
            // Tampilkan form edit
            function showClinicEdit() {
                document.getElementById('clinic-info-section').style.display = 'none';
                document.getElementById('clinic-income-section').style.display = 'none';
                document.getElementById('clinic-realization-section').style.display = 'none';
                document.getElementById('clinic-budget-section').style.display = 'none';
                document.getElementById('clinic-finance-section').style.display = 'none';
                document.getElementById('clinic-edit-section').style.display = 'block';
                
                // Update active button
                setActiveClinicButton('btn-clinic-edit');
            }
            
            // Set active clinic button
            function setActiveClinicButton(buttonId) {
                document.querySelectorAll('#btn-clinic-info, #btn-clinic-income, #btn-clinic-realization, #btn-clinic-budget, #btn-clinic-finance, #btn-clinic-edit').forEach(btn => {
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-secondary');
                });
                
                const activeBtn = document.getElementById(buttonId);
                if (activeBtn) {
                    activeBtn.classList.remove('btn-secondary');
                    activeBtn.classList.add('btn-success');
                }
            }
            
            // Load data pendapatan klinik dengan filter
            function loadClinicIncome(clinic) {
                const tbody = document.getElementById('income-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                // Filter data berdasarkan tahun dan bulan
                let filteredIncome = clinic.income.filter(item => 
                    item.year === currentIncomeFilters.year
                );
                
                if (currentIncomeFilters.month !== 'all') {
                    filteredIncome = filteredIncome.filter(item => 
                        item.month === parseInt(currentIncomeFilters.month)
                    );
                }
                
                // Sort by month
                filteredIncome.sort((a, b) => a.month - b.month);
                
                let total = 0;
                filteredIncome.forEach((report, index) => {
                    total += report.amount;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${getMonthName(report.month)}</td>
                        <td>${report.year}</td>
                        <td>Rp ${report.amount.toLocaleString('id-ID')}</td>
                        <td>
                            ${currentUser && currentUser.type === 'minkes' ? `
                            <button class="btn-warning edit-income-btn" data-index="${clinic.income.findIndex(i => i.month === report.month && i.year === report.year)}">Edit</button>
                            <button class="btn-danger delete-income-btn" data-index="${clinic.income.findIndex(i => i.month === report.month && i.year === report.year)}">Hapus</button>
                            ` : ''}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Setup event listeners untuk tombol edit dan delete
                if (currentUser && currentUser.type === 'minkes') {
                    document.querySelectorAll('.edit-income-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            editIncomeData(index);
                        });
                    });
                    
                    document.querySelectorAll('.delete-income-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            deleteIncomeData(index);
                        });
                    });
                }
                
                // Add total row
                const totalRow = document.createElement('tr');
                totalRow.style.fontWeight = 'bold';
                totalRow.style.backgroundColor = '#f8fafc';
                totalRow.innerHTML = `
                    <td colspan="2"><strong>TOTAL</strong></td>
                    <td><strong>Rp ${total.toLocaleString('id-ID')}</strong></td>
                    <td></td>
                `;
                tbody.appendChild(totalRow);
                
                // Load yearly data if monthly tab is active
                const activeTab = document.querySelector('#clinic-income-section .monthly-tab.active');
                if (activeTab && activeTab.getAttribute('data-tab') === 'yearly') {
                    loadIncomeYearlyData(clinic);
                }
            }
            
            // Load data pendapatan per tahun
            function loadIncomeYearlyData(clinic) {
                const tbody = document.getElementById('income-yearly-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                // Get unique years
                const years = [...new Set(clinic.income.map(item => item.year))].sort((a, b) => a - b);
                
                years.forEach(year => {
                    // Calculate total for the year
                    const yearlyData = clinic.income.filter(item => item.year === year);
                    const totalAmount = yearlyData.reduce((sum, item) => sum + item.amount, 0);
                    const averageAmount = Math.round(totalAmount / yearlyData.length);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${year}</td>
                        <td>Rp ${totalAmount.toLocaleString('id-ID')}</td>
                        <td>Rp ${averageAmount.toLocaleString('id-ID')}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Edit data pendapatan
            function editIncomeData(index) {
                if (!currentClinic) return;
                
                const incomeData = currentClinic.income[index];
                document.getElementById('income-month').value = incomeData.month;
                document.getElementById('income-year').value = incomeData.year;
                document.getElementById('income-amount').value = incomeData.amount;
                
                // Tampilkan form
                document.getElementById('income-form-container').style.display = 'block';
                document.getElementById('add-income-btn').style.display = 'none';
                
                // Simpan index untuk update
                document.getElementById('income-form-container').setAttribute('data-edit-index', index);
            }
            
            // Simpan data pendapatan
            function saveIncomeData() {
                if (!currentClinic) return;
                
                const month = parseInt(document.getElementById('income-month').value);
                const year = parseInt(document.getElementById('income-year').value);
                const amount = parseInt(document.getElementById('income-amount').value);
                
                if (isNaN(month) || isNaN(year) || isNaN(amount)) {
                    alert('Mohon isi semua field dengan benar');
                    return;
                }
                
                const editIndex = document.getElementById('income-form-container').getAttribute('data-edit-index');
                
                if (editIndex !== null) {
                    // Update existing data
                    currentClinic.income[parseInt(editIndex)] = { month, year, amount };
                    document.getElementById('income-form-container').removeAttribute('data-edit-index');
                } else {
                    // Add new data
                    // Cek apakah data untuk bulan dan tahun ini sudah ada
                    const existingIndex = currentClinic.income.findIndex(i => i.month === month && i.year === year);
                    if (existingIndex !== -1) {
                        // Jika sudah ada, update data yang ada
                        currentClinic.income[existingIndex] = { month, year, amount };
                    } else {
                        // Jika belum ada, tambahkan data baru
                        currentClinic.income.push({ month, year, amount });
                    }
                }
                
                // Sembunyikan form dan tampilkan tombol add
                document.getElementById('income-form-container').style.display = 'none';
                document.getElementById('add-income-btn').style.display = 'block';
                
                // Reset form
                document.getElementById('income-month').value = '';
                document.getElementById('income-year').value = new Date().getFullYear();
                document.getElementById('income-amount').value = '';
                
                // Refresh table
                loadClinicIncome(currentClinic);
                
                alert('Data pendapatan berhasil disimpan!');
            }
            
            // Hapus data pendapatan
            function deleteIncomeData(index) {
                if (!currentClinic) return;
                
                if (confirm('Apakah Anda yakin ingin menghapus data pendapatan ini?')) {
                    currentClinic.income.splice(index, 1);
                    loadClinicIncome(currentClinic);
                    alert('Data pendapatan berhasil dihapus!');
                }
            }
            
            // Load data realisasi klinik dengan filter
            function loadClinicRealization(clinic) {
                // Update honor values di form input
                document.getElementById('honor-medis-input').value = clinic.realization.honor.medis;
                document.getElementById('honor-paramedis-input').value = clinic.realization.honor.paramedis;
                document.getElementById('honor-pengelola-input').value = clinic.realization.honor.pengelola;
                
                // Update honor values di display
                document.getElementById('honor-medis-display').textContent = `Rp ${clinic.realization.honor.medis.toLocaleString('id-ID')}`;
                document.getElementById('honor-paramedis-display').textContent = `Rp ${clinic.realization.honor.paramedis.toLocaleString('id-ID')}`;
                document.getElementById('honor-pengelola-display').textContent = `Rp ${clinic.realization.honor.pengelola.toLocaleString('id-ID')}`;
                
                // Update operational values di form input
                document.getElementById('operational-atk-input').value = clinic.realization.operational.atk;
                document.getElementById('operational-obat-input').value = clinic.realization.operational.obat;
                
                // Update operational values di display
                document.getElementById('operational-atk-display').textContent = `Rp ${clinic.realization.operational.atk.toLocaleString('id-ID')}`;
                document.getElementById('operational-obat-display').textContent = `Rp ${clinic.realization.operational.obat.toLocaleString('id-ID')}`;
                
                // Update modal table
                const modalTbody = document.getElementById('modal-table-body');
                if (modalTbody) {
                    modalTbody.innerHTML = '';
                    
                    clinic.realization.modal.forEach((item, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${item.nama}</td>
                            <td>${item.satuan}</td>
                            <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
                            <td>${item.jumlah}</td>
                            <td>Rp ${item.total.toLocaleString('id-ID')}</td>
                            <td>
                                ${currentUser && currentUser.type === 'minkes' ? `
                                <button class="btn-warning edit-modal-btn" data-index="${index}">Edit</button>
                                <button class="btn-danger delete-modal-btn" data-index="${index}">Hapus</button>
                                ` : ''}
                            </td>
                        `;
                        modalTbody.appendChild(row);
                    });
                    
                    // Setup event listeners untuk tombol edit dan delete
                    if (currentUser && currentUser.type === 'minkes') {
                        document.querySelectorAll('.edit-modal-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                editModalData(index);
                            });
                        });
                        
                        document.querySelectorAll('.delete-modal-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                deleteModalData(index);
                            });
                        });
                    }
                }
                
                // Load yearly data if yearly tab is active
                const activeTab = document.querySelector('#clinic-realization-section .monthly-tab.active');
                if (activeTab && activeTab.getAttribute('data-tab') === 'yearly') {
                    loadRealizationYearlyData(clinic);
                }
            }
            
            // Load data realisasi per tahun
            function loadRealizationYearlyData(clinic) {
                const tbody = document.getElementById('realization-yearly-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                // Get unique years from budget data
                const years = [...new Set(clinic.budget.monthlyRemaining.map(item => item.year))].sort((a, b) => a - b);
                
                years.forEach(year => {
                    // Calculate totals for the year
                    const yearlyData = clinic.budget.monthlyRemaining.filter(item => item.year === year);
                    const totalSpent = yearlyData.reduce((sum, item)
